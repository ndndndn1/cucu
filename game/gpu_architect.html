<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GPU Architect: Rise from Silicon</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a1a;--card:#141428;--card2:#1a1a2e;--cyan:#00d2ff;--orange:#ff6b35;--green:#00ff88;--gold:#ffd700;--red:#ff4757;--text:#e0e0e0;--dim:#888;--border:#2a2a4a}
body{background:var(--bg);color:var(--text);font-family:'Segoe UI',system-ui,-apple-system,sans-serif;min-height:100vh;overflow-x:hidden}
a{color:var(--cyan);text-decoration:none}
button{cursor:pointer;border:none;font-family:inherit;font-size:inherit}
.btn{padding:10px 24px;border-radius:8px;font-weight:600;transition:.2s}
.btn-primary{background:var(--cyan);color:#000}.btn-primary:hover{filter:brightness(1.2)}
.btn-secondary{background:var(--card2);color:var(--text);border:1px solid var(--border)}.btn-secondary:hover{border-color:var(--cyan)}
.btn-danger{background:var(--red);color:#fff}
.btn-gold{background:linear-gradient(135deg,var(--gold),#ff8c00);color:#000}
.btn-sm{padding:6px 14px;font-size:.85rem}
.btn:disabled{opacity:.4;cursor:not-allowed}

/* Layout */
#app{max-width:900px;margin:0 auto;padding:16px}
nav{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--card);border-radius:12px;margin-bottom:20px;flex-wrap:wrap;gap:8px}
nav .logo{font-size:1.1rem;font-weight:700;color:var(--cyan)}
nav .stats{display:flex;gap:16px;font-size:.9rem}
nav .stats span{display:flex;align-items:center;gap:4px}
.fc-icon{color:var(--cyan)}
.sc-icon{color:var(--gold)}

/* Cards */
.card{background:var(--card);border-radius:12px;padding:20px;margin-bottom:16px;border:1px solid var(--border)}
.card h2{margin-bottom:12px;font-size:1.2rem}
.card h3{margin-bottom:8px;font-size:1rem;color:var(--cyan)}

/* Module Grid */
.module-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px}
.module-cell{background:var(--card2);border-radius:10px;padding:14px 10px;text-align:center;cursor:pointer;border:2px solid transparent;transition:.2s;position:relative}
.module-cell:hover:not(.locked){border-color:var(--cyan);transform:translateY(-2px)}
.module-cell.locked{opacity:.4;cursor:not-allowed}
.module-cell.completed{border-color:var(--green)}
.module-cell.current{border-color:var(--cyan)}
.module-cell.mastery{border-color:var(--gold)}
.module-cell .mod-num{font-size:1.4rem;font-weight:700;color:var(--cyan)}
.module-cell .mod-title{font-size:.75rem;margin-top:4px;color:var(--dim)}
.module-cell .mod-score{font-size:.7rem;margin-top:4px;color:var(--green)}
.module-cell .lock-icon{position:absolute;top:6px;right:8px;font-size:.8rem}

/* Rank Badge */
.rank-display{display:flex;align-items:center;gap:12px;padding:16px;background:linear-gradient(135deg,var(--card2),#1e1e3a);border-radius:12px;margin-bottom:16px}
.rank-icon{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.6rem;border:3px solid var(--cyan)}
.rank-info .rank-name{font-size:1.1rem;font-weight:700}
.rank-info .rank-sub{font-size:.8rem;color:var(--dim)}
.rank-info .gflops{color:var(--green);font-weight:600;font-size:.95rem}

/* Progress Bar */
.progress-bar{height:8px;background:var(--card2);border-radius:4px;overflow:hidden;margin:6px 0}
.progress-fill{height:100%;border-radius:4px;transition:width .5s ease}
.progress-fill.cyan{background:linear-gradient(90deg,var(--cyan),#0099cc)}
.progress-fill.green{background:linear-gradient(90deg,var(--green),#00cc66)}
.progress-fill.gold{background:linear-gradient(90deg,var(--gold),var(--orange))}

/* Quiz Screen */
.quiz-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:8px}
.combo-display{font-size:1.1rem;font-weight:700;padding:6px 14px;border-radius:20px;background:var(--card2)}
.combo-display.fire{background:linear-gradient(135deg,var(--orange),var(--red));color:#fff;animation:pulse .5s}
.gflops-meter{width:100%;height:32px;background:var(--card2);border-radius:8px;overflow:hidden;position:relative;margin:10px 0}
.gflops-fill{height:100%;background:linear-gradient(90deg,var(--red),var(--orange),var(--gold),var(--green),var(--cyan));transition:width .6s ease;border-radius:8px}
.gflops-label{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.9rem;text-shadow:0 1px 3px rgba(0,0,0,.8)}
.question-card{background:var(--card2);border-radius:12px;padding:20px;margin:12px 0}
.question-text{font-size:1rem;line-height:1.6;margin-bottom:16px;white-space:pre-wrap}
.bloom-tag{display:inline-block;padding:2px 10px;border-radius:12px;font-size:.75rem;font-weight:600;margin-bottom:8px}
.bloom-R{background:#4a3;color:#000}.bloom-U{background:#48f;color:#fff}
.bloom-Ap{background:#f80;color:#000}.bloom-An{background:#c4f;color:#fff}
.bloom-Ev{background:#f44;color:#fff}.bloom-Cr{background:var(--gold);color:#000}
.options{display:flex;flex-direction:column;gap:8px}
.option-btn{padding:12px 16px;background:var(--card);border:2px solid var(--border);border-radius:10px;text-align:left;color:var(--text);transition:.2s;font-size:.95rem;line-height:1.4}
.option-btn:hover:not(:disabled){border-color:var(--cyan);background:#1e1e3a}
.option-btn.correct{border-color:var(--green);background:#0a2a1a}
.option-btn.wrong{border-color:var(--red);background:#2a0a0a}
.option-btn:disabled{cursor:default}
.explanation{margin-top:12px;padding:12px;background:#0a1a2a;border-left:3px solid var(--cyan);border-radius:0 8px 8px 0;font-size:.9rem;line-height:1.5}

/* Code Trace */
.code-block{background:#0d0d20;border-radius:8px;padding:16px;font-family:'Cascadia Code','Fira Code',monospace;font-size:.85rem;line-height:1.6;overflow-x:auto;border:1px solid var(--border);white-space:pre;margin:10px 0}
.trace-input{display:flex;gap:8px;align-items:center;margin:10px 0}
.trace-input input{background:var(--card2);border:2px solid var(--border);border-radius:8px;padding:8px 12px;color:var(--text);font-family:monospace;font-size:1rem;width:140px}
.trace-input input:focus{outline:none;border-color:var(--cyan)}
.streak-display{font-size:1.2rem;font-weight:700}

/* Timer */
.timer{font-size:1.3rem;font-weight:700;padding:6px 16px;border-radius:20px;background:var(--card2)}
.timer.warning{color:var(--orange)}.timer.danger{color:var(--red);animation:pulse .5s infinite}

/* Boss Fight */
.boss-header{text-align:center;padding:20px;background:linear-gradient(135deg,#1a0a2e,#2a1a3e);border-radius:12px;margin-bottom:16px}
.boss-header h2{font-size:1.4rem;color:var(--gold)}
.boss-header .boss-sub{color:var(--dim);margin-top:4px}
.phase-indicator{display:flex;gap:8px;justify-content:center;margin:12px 0}
.phase-dot{width:12px;height:12px;border-radius:50%;background:var(--border)}
.phase-dot.active{background:var(--gold)}.phase-dot.done{background:var(--green)}

/* Shop */
.shop-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.shop-item{background:var(--card2);border-radius:10px;padding:14px;border:1px solid var(--border);transition:.2s}
.shop-item:hover{border-color:var(--cyan)}
.shop-item .item-name{font-weight:600;margin-bottom:4px}
.shop-item .item-desc{font-size:.8rem;color:var(--dim);margin-bottom:8px}
.shop-item .item-price{font-weight:700}

/* Achievements */
.badge-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:8px}
.badge{text-align:center;padding:10px;border-radius:10px;background:var(--card2);border:2px solid var(--border);font-size:.7rem}
.badge.earned{border-color:var(--gold)}.badge.locked{opacity:.3}
.badge .badge-icon{font-size:1.8rem;margin-bottom:4px}

/* Toast */
.toast{position:fixed;top:20px;right:20px;padding:14px 20px;border-radius:10px;font-weight:600;z-index:999;animation:slideIn .3s ease,fadeOut .3s ease 2.7s;pointer-events:none;max-width:340px}
.toast.reward{background:linear-gradient(135deg,#0a2a1a,#1a3a2a);border:1px solid var(--green);color:var(--green)}
.toast.rank{background:linear-gradient(135deg,#2a1a0a,#3a2a1a);border:1px solid var(--gold);color:var(--gold)}
.toast.error{background:linear-gradient(135deg,#2a0a0a,#3a1a1a);border:1px solid var(--red);color:var(--red)}
.toast.badge{background:linear-gradient(135deg,#1a0a2a,#2a1a3a);border:1px solid #c4f;color:#c4f}

/* Section list */
.section-list{display:flex;flex-direction:column;gap:8px}
.section-item{display:flex;align-items:center;gap:10px;padding:10px 14px;background:var(--card2);border-radius:8px;cursor:pointer;border:1px solid var(--border);transition:.2s}
.section-item:hover:not(.locked){border-color:var(--cyan)}
.section-item.locked{opacity:.4;cursor:not-allowed}
.section-item.done{border-color:var(--green)}
.section-item .sec-icon{font-size:1.2rem;width:28px;text-align:center}
.section-item .sec-name{flex:1}
.section-item .sec-reward{color:var(--cyan);font-size:.85rem;font-weight:600}

/* Tabs */
.tabs{display:flex;gap:4px;margin-bottom:16px}
.tab{padding:8px 18px;border-radius:8px 8px 0 0;background:var(--card2);border:1px solid var(--border);border-bottom:none;cursor:pointer;font-weight:600;color:var(--dim)}
.tab.active{background:var(--card);color:var(--cyan);border-color:var(--cyan);border-bottom:1px solid var(--card)}

/* Animations */
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
@keyframes slideIn{from{transform:translateX(100px);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes fadeOut{from{opacity:1}to{opacity:0}}
@keyframes coinDrop{0%{transform:translateY(-20px) scale(1.5);opacity:1}100%{transform:translateY(0) scale(1);opacity:1}}
.coin-anim{animation:coinDrop .4s ease}
.result-banner{text-align:center;padding:24px;border-radius:12px;margin:16px 0}
.result-banner.pass{background:linear-gradient(135deg,#0a2a1a,#1a3a2a);border:2px solid var(--green)}
.result-banner.fail{background:linear-gradient(135deg,#2a0a0a,#3a1a1a);border:2px solid var(--red)}
.result-banner h2{font-size:1.5rem;margin-bottom:8px}
.stat-row{display:flex;justify-content:space-around;flex-wrap:wrap;gap:12px;margin:12px 0}
.stat-box{text-align:center;padding:8px 16px}
.stat-box .stat-val{font-size:1.5rem;font-weight:700;color:var(--cyan)}
.stat-box .stat-label{font-size:.75rem;color:var(--dim)}
.back-btn{margin-bottom:12px;display:inline-block}

/* Responsive */
@media(max-width:600px){
  .module-grid{grid-template-columns:repeat(auto-fill,minmax(100px,1fr))}
  .shop-grid{grid-template-columns:1fr}
  nav .stats{font-size:.8rem;gap:10px}
}
</style>
</head>
<body>
<div id="app"></div>
<script>
// ============================================================
// GPU Architect: Rise from Silicon â€” Game Data
// All 75 quiz questions, code traces, reviews, modules, ranks
// ============================================================

// --- Module Definitions ---
const MODULES = [
  {id:'00',title:'ì„œë¡  ë° í•™ìŠµ ì•ˆë‚´',sub:'í•™ìŠµ ë¡œë“œë§µ',level:null,hasQuiz:false,hasSim:false,hasCode:false,hasReview:false},
  {id:'01',title:'GPU ì•„í‚¤í…ì²˜',sub:'SM, ì›Œí”„, ë©”ëª¨ë¦¬ ê³„ì¸µ',level:null,hasQuiz:true,hasSim:true,hasCode:false,hasReview:false},
  {id:'02',title:'CUDA í”„ë¡œê·¸ë˜ë° ê¸°ì´ˆ',sub:'Driver API, PTX JIT',level:null,hasQuiz:true,hasSim:true,hasCode:false,hasReview:false},
  {id:'03',title:'í–‰ë ¬ê³±ì…ˆ ìˆ˜í•™ì  ë°°ê²½',sub:'FLOP, ì‚°ìˆ  ê°•ë„, ë£¨í”„ë¼ì¸',level:null,hasQuiz:true,hasSim:true,hasCode:false,hasReview:false},
  {id:'04',title:'Level 0 â€” ë‚˜ì´ë¸Œ êµ¬í˜„',sub:'1 thread = 1 element',level:0,hasQuiz:true,hasSim:true,hasCode:true,hasReview:true},
  {id:'05',title:'Level 1 â€” ë©”ëª¨ë¦¬ ì½”ì–¼ë ˆì‹±',sub:'float4 ë²¡í„°í™” ë¡œë“œ',level:1,hasQuiz:true,hasSim:true,hasCode:true,hasReview:true},
  {id:'06',title:'Level 2 â€” ê³µìœ  ë©”ëª¨ë¦¬ íƒ€ì¼ë§',sub:'__shared__ + ë±…í¬ ì¶©ëŒ íŒ¨ë”©',level:2,hasQuiz:true,hasSim:true,hasCode:true,hasReview:true,mastery:true,boss:'boss1'},
  {id:'07',title:'Level 3 â€” ë ˆì§€ìŠ¤í„° ë¸”ë¡œí‚¹',sub:'8Ã—8 ì™¸ì  ë§ˆì´í¬ë¡œì»¤ë„',level:3,hasQuiz:true,hasSim:true,hasCode:true,hasReview:true},
  {id:'08',title:'Level 4 â€” ë”ë¸” ë²„í¼ë§',sub:'ì†Œí”„íŠ¸ì›¨ì–´ íŒŒì´í”„ë¼ì´ë‹',level:4,hasQuiz:true,hasSim:true,hasCode:true,hasReview:true,mastery:true,boss:'boss2'},
  {id:'09',title:'Level 5 â€” ë¹„ë™ê¸° ë³µì‚¬',sub:'cp.async, íŠ¸ë¦¬í”Œ ë²„í¼',level:5,hasQuiz:true,hasSim:true,hasCode:true,hasReview:true,mastery:true,boss:'boss3'},
  {id:'10',title:'ì¢…í•© ì„±ëŠ¥ë¶„ì„',sub:'Nsight Compute, SOL ë¶„ì„',level:null,hasQuiz:true,hasSim:true,hasCode:false,hasReview:false},
];

// --- Rank Definitions ---
const RANKS = [
  {id:'intern',name:'ìˆ˜ìŠµ ì—”ì§€ë‹ˆì–´',en:'Intern Engineer',icon:'ğŸ”°',modules:[],gflops:0,cubl:0},
  {id:'junior',name:'ì£¼ë‹ˆì–´ ì—”ì§€ë‹ˆì–´',en:'Junior Engineer',icon:'âš™ï¸',modules:['00','01','02','03'],gflops:60,cubl:3},
  {id:'engineer',name:'ì—”ì§€ë‹ˆì–´',en:'Engineer',icon:'ğŸ”§',modules:['04'],gflops:250,cubl:10},
  {id:'senior',name:'ì‹œë‹ˆì–´ ì—”ì§€ë‹ˆì–´',en:'Senior Engineer',icon:'ğŸ› ï¸',modules:['05'],masteryReq:'06',gflops:1000,cubl:30},
  {id:'staff',name:'ìŠ¤íƒœí”„ ì—”ì§€ë‹ˆì–´',en:'Staff Engineer',icon:'âš¡',modules:['06'],gflops:2500,cubl:60},
  {id:'principal',name:'í”„ë¦°ì‹œí„ ì—”ì§€ë‹ˆì–´',en:'Principal Engineer',icon:'ğŸ’',modules:['07'],masteryReq:'08',gflops:5000,cubl:78},
  {id:'distinguished',name:'ë””ìŠ¤íŒ…ê·€ì‹œë“œ ì—”ì§€ë‹ˆì–´',en:'Distinguished Engineer',icon:'ğŸŒŸ',modules:['08'],masteryReq:'09',gflops:8000,cubl:90},
  {id:'chip_architect',name:'ì¹© ì•„í‚¤í…íŠ¸',en:'Chip Architect',icon:'ğŸ‘‘',modules:['09','10'],gflops:9500,cubl:95},
];

// --- Quiz Data: All 75 Questions ---
// Format: {q, o:[4 options], a:correctIndex, b:bloomLevel, e:explanation}
const QUIZZES = {
'01': [
  {q:'GPUì—ì„œ í•˜ë‚˜ì˜ ì›Œí”„(Warp)ë¥¼ êµ¬ì„±í•˜ëŠ” ìŠ¤ë ˆë“œ ìˆ˜ëŠ”?',o:['16ê°œ','32ê°œ','64ê°œ','128ê°œ'],a:1,b:'R',e:'WARP_SIZE = 32. NVIDIA GPUì˜ ê¸°ë³¸ ì‹¤í–‰ ë‹¨ìœ„ì¸ ì›Œí”„ëŠ” í•­ìƒ 32ê°œ ìŠ¤ë ˆë“œë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.'},
  {q:'ê¸€ë¡œë²Œ ë©”ëª¨ë¦¬(HBM) ì ‘ê·¼ì˜ ì§€ì—°ì‹œê°„ì€ ì•½ ëª‡ ì‚¬ì´í´ì¸ê°€?',o:['20-30 ì‚¬ì´í´','100-200 ì‚¬ì´í´','400-600 ì‚¬ì´í´','2000-3000 ì‚¬ì´í´'],a:2,b:'R',e:'ê¸€ë¡œë²Œ ë©”ëª¨ë¦¬ ì ‘ê·¼ì€ ì•½ 400-600 ì‚¬ì´í´ì˜ ë ˆì´í„´ì‹œë¥¼ ê°€ì§‘ë‹ˆë‹¤. ë ˆì§€ìŠ¤í„°(1 ì‚¬ì´í´), ê³µìœ  ë©”ëª¨ë¦¬(20-30 ì‚¬ì´í´)ì™€ ë¹„êµë©ë‹ˆë‹¤.'},
  {q:'ë ˆì§€ìŠ¤í„°ì™€ ê³µìœ  ë©”ëª¨ë¦¬ì˜ ë²”ìœ„(scope) ì°¨ì´ë¡œ ì˜³ì€ ê²ƒì€?',o:['ë‘˜ ë‹¤ ë¸”ë¡ ë‹¨ìœ„ë¡œ ê³µìœ ','ë ˆì§€ìŠ¤í„°=ìŠ¤ë ˆë“œ ì „ìš©, ê³µìœ  ë©”ëª¨ë¦¬=ë¸”ë¡ ê³µìœ ','ë ˆì§€ìŠ¤í„°=ë¸”ë¡ ê³µìœ , ê³µìœ  ë©”ëª¨ë¦¬=ê·¸ë¦¬ë“œ ê³µìœ ','ë‘˜ ë‹¤ ìŠ¤ë ˆë“œ ì „ìš©'],a:1,b:'U',e:'ë ˆì§€ìŠ¤í„°ëŠ” thread-private, ê³µìœ  ë©”ëª¨ë¦¬ëŠ” block-sharedì…ë‹ˆë‹¤.'},
  {q:'GPUê°€ CPUë³´ë‹¤ í–‰ë ¬ê³±ì— ìœ ë¦¬í•œ ì´ìœ ë¡œ ì ì ˆí•˜ì§€ ì•Šì€ ê²ƒì€?',o:['ë†’ì€ ë°ì´í„° ë³‘ë ¬ì„±','ë†’ì€ ë‹¨ì¼ ìŠ¤ë ˆë“œ ì„±ëŠ¥','ë†’ì€ ì—°ì‚°/ë©”ëª¨ë¦¬ ë¹„ìœ¨','ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë©”ëª¨ë¦¬ ì ‘ê·¼ íŒ¨í„´'],a:1,b:'U',e:'GPUì˜ ë‹¨ì¼ ìŠ¤ë ˆë“œ ì„±ëŠ¥ì€ CPUë³´ë‹¤ ë‚®ìŠµë‹ˆë‹¤. GPUì˜ ê°•ì ì€ ëŒ€ê·œëª¨ ë³‘ë ¬ì„±ê³¼ ë†’ì€ ì²˜ë¦¬ëŸ‰ì…ë‹ˆë‹¤.'},
  {q:'4096Ã—4096 í–‰ë ¬ì— 16Ã—16 ìŠ¤ë ˆë“œ ë¸”ë¡ì¼ ë•Œ, ê·¸ë¦¬ë“œì˜ ë¸”ë¡ ìˆ˜ëŠ”?',o:['256 ë¸”ë¡','4,096 ë¸”ë¡','65,536 ë¸”ë¡','16,777,216 ë¸”ë¡'],a:2,b:'Ap',e:'dim3(4096/16, 4096/16) = dim3(256, 256), ì´ 65,536 ë¸”ë¡ì…ë‹ˆë‹¤.'},
  {q:'SMë‹¹ ìµœëŒ€ ë ˆì§€ìŠ¤í„° 65,536ê°œ, ì»¤ë„ì´ ìŠ¤ë ˆë“œë‹¹ 128ê°œ ì‚¬ìš© ì‹œ SMë‹¹ ìµœëŒ€ ìŠ¤ë ˆë“œ ìˆ˜ëŠ”?',o:['256 (ì ìœ ìœ¨ 12.5%)','512 (ì ìœ ìœ¨ 25%)','1024 (ì ìœ ìœ¨ 50%)','2048 (ì ìœ ìœ¨ 100%)'],a:1,b:'Ap',e:'65,536 / 128 = 512 ìŠ¤ë ˆë“œ = 16 ì›Œí”„. ìµœëŒ€ 2048 ëŒ€ë¹„ ì ìœ ìœ¨ 25%ì…ë‹ˆë‹¤.'},
  {q:'ì ìœ ìœ¨ì´ 25%ì¸ë° ë†’ì€ ì„±ëŠ¥ì„ ë³´ì´ëŠ” ê²½ìš°ì˜ ì£¼ëœ ì›ì¸ì€?',o:['L2 ìºì‹œ ì ì¤‘ë¥ ì´ ë†’ì•„ì„œ','ë ˆì§€ìŠ¤í„° ë¸”ë¡œí‚¹ì— ì˜í•œ ë†’ì€ ILP','ê³µìœ  ë©”ëª¨ë¦¬ ëŒ€ì—­í­ì´ ì¶©ë¶„í•´ì„œ','ì›Œí”„ ìŠ¤ì¼€ì¤„ëŸ¬ì˜ ìµœì í™” ë•ë¶„'],a:1,b:'An',e:'64ê°œ ë…ë¦½ FMA ëª…ë ¹ì–´ê°€ ë†’ì€ ILP(ëª…ë ¹ì–´ ìˆ˜ì¤€ ë³‘ë ¬ì„±)ë¥¼ ì œê³µí•˜ì—¬, TLPê°€ ë‚®ì•„ë„ íŒŒì´í”„ë¼ì¸ì„ ê°€ë“ ì±„ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'},
  {q:'supports_async_copyê°€ compute_major >= 8ì¼ ë•Œ trueì¸ ì´ìœ ëŠ”?',o:['Turingì—ì„œ cp.async ë„ì…','Ampereì—ì„œ cp.async ë„ì…','Hopperì—ì„œ cp.async ë„ì…','ëª¨ë“  ì„¸ëŒ€ì—ì„œ ì§€ì›'],a:1,b:'U',e:'cp.async ëª…ë ¹ì–´ëŠ” Compute Capability 8.0 (Ampere) ì´ìƒì—ì„œë§Œ ì§€ì›ë©ë‹ˆë‹¤.'},
],
'02': [
  {q:'Driver APIì—ì„œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ ì´ë¦„ì€?',o:['cudaCreateContext','cuCtxCreate','cuContextInit','cuDeviceCreateContext'],a:1,b:'R',e:'cuCtxCreateëŠ” CUDA Driver APIì—ì„œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.'},
  {q:'PTX JIT ì»´íŒŒì¼ì˜ ì¥ì ì´ ì•„ë‹Œ ê²ƒì€?',o:['ì•„í‚¤í…ì²˜ ì´ì‹ì„±','ëŸ°íƒ€ì„ ìµœì í™”','ì»´íŒŒì¼ ì‹œê°„ ë‹¨ì¶•','ë™ì  ë¡œë”©'],a:2,b:'U',e:'JIT ì»´íŒŒì¼ì€ ëŸ°íƒ€ì„ì— ìˆ˜í–‰ë˜ë¯€ë¡œ ì˜¤íˆë ¤ ì´ˆê¸° ë¡œë”© ì‹œê°„ì´ ì¦ê°€í•©ë‹ˆë‹¤. ì¥ì ì€ ì´ì‹ì„±, ìµœì í™”, ë™ì  ë¡œë”©ì…ë‹ˆë‹¤.'},
  {q:'ì»¤ë„ íŒŒë¼ë¯¸í„° ë°°ì—´ void** argsì—ì„œ ê° ì›ì†Œê°€ ë‹´ëŠ” ê²ƒì€?',o:['ë³€ìˆ˜ì˜ ê°’ ìì²´','ë³€ìˆ˜ì˜ ì£¼ì†Œ(í¬ì¸í„°)','ë³€ìˆ˜ì˜ íƒ€ì… ì •ë³´','ë³€ìˆ˜ì˜ í¬ê¸°(bytes)'],a:1,b:'Ap',e:'void* args[] = { &d_A, &d_B, &d_C, &N }; ê° ì›ì†ŒëŠ” ê°’ì˜ ì£¼ì†Œì…ë‹ˆë‹¤.'},
  {q:'JIT ì»´íŒŒì¼ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë¡œê·¸ë¥¼ ì–»ëŠ” ë° ì‚¬ìš©í•˜ëŠ” ì˜µì…˜ì€?',o:['CU_JIT_INFO_LOG_BUFFER','CU_JIT_ERROR_LOG_BUFFER','CU_JIT_COMPILE_LOG','CU_JIT_FAILURE_REASON'],a:1,b:'An',e:'CU_JIT_ERROR_LOG_BUFFERì™€ CU_JIT_ERROR_LOG_BUFFER_SIZE_BYTES ì˜µì…˜ìœ¼ë¡œ ì—ëŸ¬ ë¡œê·¸ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'},
  {q:'DeviceMemoryì—ì„œ RAII íŒ¨í„´ì´ ì¤‘ìš”í•œ ì´ìœ ëŠ”?',o:['ì„±ëŠ¥ì´ í–¥ìƒë˜ë¯€ë¡œ','GPU ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë°©ì§€í•˜ë¯€ë¡œ','ì½”ë“œê°€ ì§§ì•„ì§€ë¯€ë¡œ','ë©€í‹°ìŠ¤ë ˆë“œ ì•ˆì „ì„±ì„ ìœ„í•´'],a:1,b:'U',e:'GPU ë©”ëª¨ë¦¬ëŠ” ì œí•œì ì´ê³  ëˆ„ìˆ˜ ì‹œ ìë™ íšŒìˆ˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. RAIIë¡œ ì˜ˆì™¸ ë°œìƒ ì‹œì—ë„ ì•ˆì „í•˜ê²Œ í•´ì œí•©ë‹ˆë‹¤.'},
  {q:'4096Ã—4096 float í–‰ë ¬ 3ê°œì˜ GPU ë©”ëª¨ë¦¬ í• ë‹¹ëŸ‰ì€?',o:['48 MB','96 MB','192 MB','384 MB'],a:2,b:'Ap',e:'4096Ã—4096Ã—4 = 67,108,864 ë°”ì´íŠ¸ = 64 MB. 3ê°œ í–‰ë ¬ì´ë©´ 192 MBì…ë‹ˆë‹¤.'},
],
'03': [
  {q:'SGEMM ì´ FLOP ìˆ˜ ê³µì‹ì€?',o:['M Ã— N Ã— K','2 Ã— M Ã— N Ã— K','M Ã— N Ã— K Ã— 3','M Ã— N + N Ã— K'],a:1,b:'R',e:'Cì˜ ê° ì›ì†ŒëŠ” Kë²ˆì˜ ê³±ì…ˆê³¼ Kë²ˆì˜ ë§ì…ˆ = 2K FLOPs. ì´ MÃ—N ì›ì†Œì´ë¯€ë¡œ 2Ã—MÃ—NÃ—Kì…ë‹ˆë‹¤.'},
  {q:'M=N=K=2048ì¼ ë•Œ ì´ GFLOP ìˆ˜ëŠ”?',o:['ì•½ 4.29','ì•½ 8.59','ì•½ 17.18','ì•½ 34.36'],a:2,b:'Ap',e:'2 Ã— 2048Â³ = 2 Ã— 8,589,934,592 â‰ˆ 17.18 GFLOPì…ë‹ˆë‹¤.'},
  {q:'"ì‚°ìˆ  ê°•ë„ê°€ ë†’ë‹¤"ëŠ” ê²ƒì˜ ì˜ë¯¸ëŠ”?',o:['ì—°ì‚° ì†ë„ê°€ ë¹ ë¥´ë‹¤','ì „ì†¡ ë°”ì´íŠ¸ ëŒ€ë¹„ ë§ì€ ì—°ì‚° ìˆ˜í–‰','ë©”ëª¨ë¦¬ ëŒ€ì—­í­ì´ í¬ë‹¤','ì½”ë“œê°€ íš¨ìœ¨ì ì´ë‹¤'],a:1,b:'U',e:'ì‚°ìˆ  ê°•ë„ = FLOP/byte. ë†’ìœ¼ë©´ ë°ì´í„°ë¥¼ í•œ ë²ˆ ë¡œë“œ í›„ ì—¬ëŸ¬ ë²ˆ ì¬ì‚¬ìš©í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.'},
  {q:'M=N=K=4096, ì‹¤í–‰ ì‹œê°„ 2.0msì¼ ë•Œ GFLOP/sëŠ”?',o:['ì•½ 17,180','ì•½ 34,360','ì•½ 68,720','ì•½ 137,440'],a:2,b:'Ap',e:'2Ã—4096Â³/2.0ms = 137.44 GFLOP / 0.002s â‰ˆ 68,720... ì•„, ê³„ì‚°: 2Ã—4096Â³ = 137,438,953,472 FLOP Ã· 0.002 = 68,719 GFLOP/s. ì´ ê°’ì€ ë¹„í˜„ì‹¤ì ì´ë©° í”¼í¬ë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.'},
  {q:'ë£¨í”„ë¼ì¸ ëª¨ë¸ì—ì„œ ë¦¿ì§€ í¬ì¸íŠ¸ë¥¼ ê²°ì •í•˜ëŠ” ìš”ì†Œ 2ê°€ì§€ëŠ”?',o:['ì½”ì–´ ìˆ˜ì™€ í´ëŸ­','í”¼í¬ GFLOP/sì™€ í”¼í¬ ë©”ëª¨ë¦¬ ëŒ€ì—­í­','ìºì‹œ í¬ê¸°ì™€ ë ˆì´í„´ì‹œ','SM ìˆ˜ì™€ ì›Œí”„ í¬ê¸°'],a:1,b:'An',e:'ë¦¿ì§€ í¬ì¸íŠ¸ = í”¼í¬ GFLOP/s Ã· í”¼í¬ GB/s. ì´ ë‘ í•˜ë“œì›¨ì–´ ìš”ì†Œê°€ ë¦¿ì§€ í¬ì¸íŠ¸ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.'},
],
'04': [
  {q:'ë‚˜ì´ë¸Œ ì»¤ë„ì—ì„œ í•œ ìŠ¤ë ˆë“œê°€ ê³„ì‚°í•˜ëŠ” C ì›ì†Œì˜ ìˆ˜ëŠ”?',o:['1ê°œ','4ê°œ','8ê°œ','16ê°œ'],a:0,b:'R',e:'ë‚˜ì´ë¸Œ êµ¬í˜„ì—ì„œëŠ” 1 thread = 1 output elementì…ë‹ˆë‹¤.'},
  {q:'blockIdx.yì˜ ì—­í• ì€?',o:['ë¸”ë¡ ë‚´ ìŠ¤ë ˆë“œ yì¶• ìœ„ì¹˜','ê·¸ë¦¬ë“œ ë‚´ ë¸”ë¡ yì¶• ìœ„ì¹˜','ì›Œí”„ ë‚´ ìŠ¤ë ˆë“œ ì¸ë±ìŠ¤','SM ë‚´ ë¸”ë¡ ì¸ë±ìŠ¤'],a:1,b:'U',e:'blockIdx.yëŠ” ê·¸ë¦¬ë“œ ë‚´ì—ì„œ í•´ë‹¹ ë¸”ë¡ì˜ yì¶• ì¢Œí‘œë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.'},
  {q:'M=1024, N=1024, ë¸”ë¡ 16Ã—16ì¼ ë•Œ ì´ ìŠ¤ë ˆë“œ ìˆ˜ëŠ”?',o:['65,536','262,144','1,048,576','4,194,304'],a:2,b:'Ap',e:'ê·¸ë¦¬ë“œ: 64Ã—64 = 4,096 ë¸”ë¡. ë¸”ë¡ë‹¹ 256 ìŠ¤ë ˆë“œ. ì´ 1,048,576 ìŠ¤ë ˆë“œì…ë‹ˆë‹¤.'},
  {q:'ê°™ì€ ì›Œí”„ì—ì„œ tyê°€ ë‹¤ë¥¸ ë‘ ìŠ¤ë ˆë“œì˜ A ì ‘ê·¼ ì£¼ì†Œ ì°¨ì´(lda=4096)ëŠ”?',o:['4 ë°”ì´íŠ¸','1,024 ë°”ì´íŠ¸','16,384 ë°”ì´íŠ¸','65,536 ë°”ì´íŠ¸'],a:2,b:'An',e:'lda Ã— sizeof(float) = 4096 Ã— 4 = 16,384 ë°”ì´íŠ¸. ì´ëŠ” ë¹„ì½”ì–¼ë ˆì‹± ì ‘ê·¼ì…ë‹ˆë‹¤.'},
  {q:'ë‚˜ì´ë¸Œ ì»¤ë„ì˜ ì‚°ìˆ  ê°•ë„ê°€ ë‚®ì€ ê·¼ë³¸ ì›ì¸ì€?',o:['ë£¨í”„ ë°˜ë³µì´ ë§ì•„ì„œ','ê³µìœ  ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì„œ','ë ˆì§€ìŠ¤í„°ê°€ ë¶€ì¡±í•´ì„œ','ë¸”ë¡ í¬ê¸°ê°€ ì‘ì•„ì„œ'],a:1,b:'An',e:'ë°ì´í„° ì¬ì‚¬ìš©ì´ ì—†ì–´ ì‚°ìˆ  ê°•ë„ê°€ 0.25 FLOP/byteë¡œ ë§¤ìš° ë‚®ìŠµë‹ˆë‹¤. ê³µìœ  ë©”ëª¨ë¦¬ ìºì‹±ì´ í•µì‹¬ í•´ê²°ì±…ì…ë‹ˆë‹¤.'},
  {q:'__restrict__ í‚¤ì›Œë“œì˜ ëª©ì ì€?',o:['ë©”ëª¨ë¦¬ë¥¼ ì •ë ¬í•˜ê¸° ìœ„í•´','í¬ì¸í„° ê°„ ë©”ëª¨ë¦¬ ê²¹ì¹¨ì´ ì—†ìŒì„ ë³´ì¥','ìŠ¤ë ˆë“œë¥¼ ë™ê¸°í™”í•˜ê¸° ìœ„í•´','ë ˆì§€ìŠ¤í„° ì‚¬ìš©ì„ ì¤„ì´ê¸° ìœ„í•´'],a:1,b:'U',e:'__restrict__ëŠ” ì»´íŒŒì¼ëŸ¬ì—ê²Œ í¬ì¸í„° ì—ì¼ë¦¬ì–´ì‹±ì´ ì—†ìŒì„ ì•Œë ¤ ìµœì í™”ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.'},
  {q:'K=4096ì¼ ë•Œ í•œ ìŠ¤ë ˆë“œì˜ ì´ ê¸€ë¡œë²Œ ë©”ëª¨ë¦¬ ë¡œë“œ íšŸìˆ˜ëŠ”?',o:['ì•½ 2,048íšŒ','ì•½ 4,096íšŒ','ì•½ 8,194íšŒ','ì•½ 16,384íšŒ'],a:2,b:'Ap',e:'Aì—ì„œ Kë²ˆ + Bì—ì„œ Kë²ˆ + ê²½ê³„ ì¡°ê±´ = ì•½ 8,194íšŒ ê¸€ë¡œë²Œ ë©”ëª¨ë¦¬ ì ‘ê·¼ì…ë‹ˆë‹¤.'},
  {q:'cuBLASì˜ 1-5%ì— ë¶ˆê³¼í•œ ê·¼ë³¸ ì›ì¸ 3ê°€ì§€ ì¤‘ í•´ë‹¹í•˜ì§€ ì•ŠëŠ” ê²ƒì€?',o:['ë©”ëª¨ë¦¬ ì½”ì–¼ë ˆì‹± ë¶€ì¬','ë°ì´í„° ì¬ì‚¬ìš© ë¶€ì¬','ë¸”ë¡ í¬ê¸°ê°€ 16Ã—16ì´ë¼ì„œ','ë‚®ì€ ì‚°ìˆ  ê°•ë„ 0.25 FLOP/byte'],a:2,b:'Ev',e:'ë¸”ë¡ í¬ê¸° 16Ã—16ì€ ì ì ˆí•©ë‹ˆë‹¤. ê·¼ë³¸ ì›ì¸ì€ ë¹„ì½”ì–¼ë ˆì‹±, ì¬ì‚¬ìš© ë¶€ì¬, ë‚®ì€ ì‚°ìˆ  ê°•ë„ì…ë‹ˆë‹¤.'},
],
'05': [
  {q:'128-bit ë²¡í„°í™” ë¡œë“œì— ëŒ€ì‘í•˜ëŠ” SASS ëª…ë ¹ì–´ëŠ”?',o:['LDG.E','LDG.E.64','LDG.E.128','LDS.128'],a:2,b:'R',e:'float4 (128-bit) ë²¡í„°í™” ë¡œë“œëŠ” SASSì—ì„œ LDG.E.128 ëª…ë ¹ì–´ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.'},
  {q:'ë©”ëª¨ë¦¬ ì½”ì–¼ë ˆì‹±ì´ ì¤‘ìš”í•œ ì´ìœ ëŠ”?',o:['ìºì‹œ ì ì¤‘ë¥ ì„ ë†’ì´ë¯€ë¡œ','ì½”ì–¼ë ˆì‹± ì—†ìœ¼ë©´ ìµœëŒ€ 32ë°° ëŒ€ì—­í­ ë‚­ë¹„','ë ˆì§€ìŠ¤í„° ì‚¬ìš©ì„ ì¤„ì´ë¯€ë¡œ','ì»´íŒŒì¼ ì‹œê°„ì´ ë‹¨ì¶•ë˜ë¯€ë¡œ'],a:1,b:'U',e:'ì›Œí”„ì˜ 32 ìŠ¤ë ˆë“œê°€ ë¹„ì½”ì–¼ë ˆì‹± ì ‘ê·¼í•˜ë©´ ìµœëŒ€ 32ê°œ íŠ¸ëœì­ì…˜ì´ í•„ìš”í•´ 32ë°° ëŒ€ì—­í­ ë‚­ë¹„ì…ë‹ˆë‹¤.'},
  {q:'K=1024ì¼ ë•Œ ë²¡í„°í™” ë£¨í”„ì˜ ë°˜ë³µ íšŸìˆ˜ëŠ”?',o:['128íšŒ','256íšŒ','512íšŒ','1024íšŒ'],a:1,b:'Ap',e:'K_vec = K / 4 = 1024 / 4 = 256íšŒì…ë‹ˆë‹¤.'},
  {q:'B í–‰ë ¬ ì ‘ê·¼ì´ float4 ë²¡í„°í™”ê°€ ë¶ˆê°€ëŠ¥í•œ ì´ìœ ëŠ”?',o:['Bê°€ ì •ìˆ˜í˜•ì´ë¼ì„œ','k ì¦ê°€ ì‹œ ldbÃ—4 ë°”ì´íŠ¸ ì í”„í•˜ì—¬ ë¶ˆì—°ì†','Bê°€ ì½ê¸° ì „ìš©ì´ë¼ì„œ','ì •ë ¬ì´ ì•ˆ ë˜ì–´ ìˆì–´ì„œ'],a:1,b:'An',e:'kë¥¼ ë°”ê¾¸ë©´ ldbÃ—4 ë°”ì´íŠ¸ë§Œí¼ ì í”„í•˜ì—¬ ì—°ì†ì ì¸ 16ë°”ì´íŠ¸ ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.'},
  {q:'FETCH_FLOAT4(A[row * lda + k*4])ë¥¼ ì „ê°œí•˜ë©´?',o:['*(float4*)(&A[row*lda+k*4])','reinterpret_cast<const float4*>(&(A[row*lda+k*4]))[0]','__ldg(&A[row*lda+k*4])','atomicAdd(&A[row*lda+k*4], 0)'],a:1,b:'Ap',e:'FETCH_FLOAT4 ë§¤í¬ë¡œëŠ” ì£¼ì†Œë¥¼ float4 í¬ì¸í„°ë¡œ ìºìŠ¤íŒ… í›„ ì—­ì°¸ì¡°í•©ë‹ˆë‹¤.'},
  {q:'ì „ì¹˜ëœ Bë¥¼ ì‚¬ìš©í•˜ë©´ ë‚˜ì€ ì´ìœ ëŠ”?',o:['í–‰ë ¬ í¬ê¸°ê°€ ì¤„ì–´ì„œ','Bë„ float4 ì—°ì† ì ‘ê·¼ì´ ê°€ëŠ¥í•´ì ¸ì„œ','ì—°ì‚°ëŸ‰ì´ ì¤„ì–´ì„œ','ë™ê¸°í™”ê°€ ë¶ˆí•„ìš”í•´ì„œ'],a:1,b:'U',e:'BT[col][k]ì—ì„œ kê°€ ì—´ ë°©í–¥ìœ¼ë¡œ ì—°ì† ë°°ì¹˜ë˜ì–´ Aì™€ B ëª¨ë‘ float4 ë²¡í„°í™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.'},
  {q:'Level 0 ëŒ€ë¹„ Level 1ì˜ 3-5ë°° í–¥ìƒì˜ í•œê³„ ì›ì¸ì€?',o:['ë ˆì§€ìŠ¤í„°ê°€ ë¶€ì¡±í•´ì„œ','ì‚°ìˆ  ê°•ë„ê°€ ì—¬ì „íˆ 0.25ë¡œ ë‚®ì•„ì„œ','ë¸”ë¡ í¬ê¸°ê°€ ì‘ì•„ì„œ','PTXê°€ ë¹„íš¨ìœ¨ì ì´ë¼ì„œ'],a:1,b:'Ev',e:'ì‹¤íš¨ ëŒ€ì—­í­ì€ 60-80%ë¡œ í–¥ìƒë˜ì—ˆìœ¼ë‚˜, ì‚°ìˆ  ê°•ë„ëŠ” ì—¬ì „íˆ 0.25 FLOP/byteë¡œ ë©”ëª¨ë¦¬ ë°”ìš´ë“œì…ë‹ˆë‹¤.'},
],
'06': [
  {q:'GPU ê³µìœ  ë©”ëª¨ë¦¬ì˜ ë±…í¬ ìˆ˜ëŠ”?',o:['16ê°œ','32ê°œ','64ê°œ','128ê°œ'],a:1,b:'R',e:'GPU ê³µìœ  ë©”ëª¨ë¦¬ëŠ” 32ê°œ ë±…í¬ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'},
  {q:'ê³µìœ  ë©”ëª¨ë¦¬ íƒ€ì¼ë§ì˜ í•µì‹¬ ì›ë¦¬ë¥¼ ê°€ì¥ ì˜ í‘œí˜„í•œ ê²ƒì€?',o:['ìŠ¤ë ˆë“œ ìˆ˜ë¥¼ ëŠ˜ë ¤ ë³‘ë ¬ì„± ì¦ê°€','ë°ì´í„°ë¥¼ ê¸€ë¡œë²Œì—ì„œ 1ë²ˆ ë¡œë“œ, ê³µìœ ì—ì„œ BLOCK_SIZEë²ˆ ì¬ì‚¬ìš©','ìºì‹œ ì ì¤‘ë¥ ì„ ìµœì í™”','ë£¨í”„ë¥¼ ì–¸ë¡¤í•˜ì—¬ ë¶„ê¸° ì œê±°'],a:1,b:'U',e:'íƒ€ì¼ë§ì˜ í•µì‹¬ì€ ë°ì´í„° ì¬ì‚¬ìš©ì…ë‹ˆë‹¤. ê¸€ë¡œë²Œ ë©”ëª¨ë¦¬ì—ì„œ í•œ ë²ˆ ë¡œë“œí•œ ë°ì´í„°ë¥¼ ê³µìœ  ë©”ëª¨ë¦¬ì—ì„œ BLOCK_SIZEë²ˆ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.'},
  {q:'BLOCK_SIZE=32ì¼ ë•Œ ê³µìœ  ë©”ëª¨ë¦¬ ì´ ì‚¬ìš©ëŸ‰(íŒ¨ë”© ë¬´ì‹œ)ì€?',o:['4 KB','8 KB','16 KB','32 KB'],a:1,b:'Ap',e:'A_tile(32Ã—32) + B_tile(32Ã—32) = 2 Ã— 32 Ã— 32 Ã— 4 = 8,192 ë°”ì´íŠ¸ = 8 KBì…ë‹ˆë‹¤.'},
  {q:'í˜‘ë ¥ì  ë¡œë”©ì—ì„œ A_tile[ty][tx]ì— ë¡œë“œí•˜ëŠ” ê¸€ë¡œë²Œ ë©”ëª¨ë¦¬ ì£¼ì†ŒëŠ”?',o:['A[row * lda + t * BLOCK_SIZE + tx]','A[ty * lda + tx]','A[blockIdx.y * lda + tx]','A[row * N + col]'],a:0,b:'Ap',e:'a_col = t * BLOCK_SIZE_K + txì´ê³  A[row * lda + a_col]ì…ë‹ˆë‹¤.'},
  {q:'ë‘ ë²ˆì§¸ __syncthreads()ë¥¼ ì œê±°í•˜ë©´ ë°œìƒí•˜ëŠ” ë¬¸ì œëŠ”?',o:['ì»´íŒŒì¼ ì—ëŸ¬','ë¹ ë¥¸ ìŠ¤ë ˆë“œê°€ ë‹¤ìŒ íƒ€ì¼ì„ ë®ì–´ì¨ ì˜ëª»ëœ ê°’ ì‚¬ìš©','ì„±ëŠ¥ì´ ì‚´ì§ ì €í•˜','ì•„ë¬´ ë¬¸ì œ ì—†ìŒ'],a:1,b:'An',e:'ë¹ ë¥¸ ìŠ¤ë ˆë“œê°€ ë‹¤ìŒ íƒ€ì¼ì˜ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ì—¬ ê¸°ì¡´ ê°’ì„ ë®ì–´ì“°ë©´, ëŠë¦° ìŠ¤ë ˆë“œê°€ ì˜ëª»ëœ ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.'},
  {q:'íŒ¨ë”© ì—†ì´ ty=0ê³¼ ty=2ê°€ A_tile[ty][0] ì ‘ê·¼ ì‹œ ë‘˜ ë‹¤ ê°™ì€ ë±…í¬ì— ë§¤í•‘ë˜ëŠ” ì´ìœ ëŠ”?',o:['ë°°ì—´ í­ 16ì˜ ë°°ìˆ˜ê°€ 32ì˜ ì•½ìˆ˜ì´ë¯€ë¡œ','ë±…í¬ í• ë‹¹ì´ ëœë¤ì´ë¯€ë¡œ','tyê°€ í™€ìˆ˜/ì§ìˆ˜ì´ë¯€ë¡œ','íŒ¨ë”©ì´ ìˆìœ¼ë©´ ë‹¬ë¼ì§€ì§€ ì•Šìœ¼ë¯€ë¡œ'],a:0,b:'An',e:'í­=16ì¼ ë•Œ bank=(ty*16+0)%32. ty=0â†’bank 0, ty=2â†’bank 0 (32%32=0). 16ì´ 32ì˜ ì•½ìˆ˜ì´ë¯€ë¡œ ì¶©ëŒì´ ë°œìƒí•©ë‹ˆë‹¤.'},
  {q:'fma.rn.f32 %0, %1, %2, %0ì—ì„œ ìˆ˜í–‰í•˜ëŠ” ì—°ì‚°ì€?',o:['%0 = %1 + %2','%0 = %1 * %2','%0 = %1 * %2 + %0','%0 = %0 * %1 + %2'],a:2,b:'Ap',e:'FMA: d = a * b + c. ì—¬ê¸°ì„œ %0(sum) = %1(Aê°’) Ã— %2(Bê°’) + %0(ëˆ„ì í•©)ì…ë‹ˆë‹¤.'},
  {q:'íƒ€ì¼ë§ì˜ ë©”ëª¨ë¦¬ íŠ¸ë˜í”½ ê°ì†Œ ë°°ìœ¨ì€ 16ë°°ì¸ë° cuBLASì˜ 20-40%ì¸ ì´ìœ ë¡œ ì ì ˆí•˜ì§€ ì•Šì€ ê²ƒì€?',o:['ì‚°ìˆ  ê°•ë„ 4.0ì€ ì—¬ì „íˆ ë¶€ì¡±','ë ˆì´í„´ì‹œ ì€ë‹‰ ë©”ì»¤ë‹ˆì¦˜ ë¶€ì¬','ë¸”ë¡ í¬ê¸° 16Ã—16ì´ ë„ˆë¬´ ì‘ì•„ì„œ','ìŠ¤ë ˆë“œë‹¹ 1ì›ì†Œ ê³„ì‚°ìœ¼ë¡œ ë ˆì§€ìŠ¤í„° ë¹„íš¨ìœ¨'],a:2,b:'Ev',e:'ë¸”ë¡ í¬ê¸°ëŠ” ë¬¸ì œê°€ ì•„ë‹™ë‹ˆë‹¤. ì§„ì§œ ì´ìœ ëŠ” ì‚°ìˆ  ê°•ë„ ë¶€ì¡±, ë ˆì´í„´ì‹œ ì€ë‹‰ ë¶€ì¬, ë ˆì§€ìŠ¤í„° ë¹„íš¨ìœ¨ì…ë‹ˆë‹¤.'},
],
'07': [
  {q:'TM=8, TN=8ì¼ ë•Œ í•œ ìŠ¤ë ˆë“œê°€ ê³„ì‚°í•˜ëŠ” C ì›ì†Œ ìˆ˜ëŠ”?',o:['8ê°œ','16ê°œ','32ê°œ','64ê°œ'],a:3,b:'R',e:'TM Ã— TN = 8 Ã— 8 = 64ê°œì˜ C ì›ì†Œë¥¼ í•œ ìŠ¤ë ˆë“œê°€ ê³„ì‚°í•©ë‹ˆë‹¤.'},
  {q:'ë ˆì§€ìŠ¤í„° ë¸”ë¡œí‚¹ì´ ì‚°ìˆ  ê°•ë„ë¥¼ ë†’ì´ëŠ” ê³µì‹ì€?',o:['AI = TM + TN','AI = TM Ã— TN / (TM + TN)','AI = TM Ã— TN / (2 Ã— (TM + TN))','AI = 2 Ã— TM Ã— TN'],a:2,b:'U',e:'AI = TMÃ—TN / (2Ã—(TM+TN)). TM=TN=8ì¼ ë•Œ 64/32 = 2.0 FLOP/byteì…ë‹ˆë‹¤.'},
  {q:'BM=128, BN=128, BK=8ì¼ ë•Œ ê³µìœ  ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰(íŒ¨ë”© í¬í•¨)ì€?',o:['4 KB','8 KB','ì•½ 8.5 KB','16 KB'],a:2,b:'Ap',e:'A: 128Ã—(8+1)Ã—4 + B: 8Ã—(128+1)Ã—4 = 4,608 + 4,128 = 8,736 â‰ˆ 8.5 KBì…ë‹ˆë‹¤.'},
  {q:'256ê°œ ìŠ¤ë ˆë“œê°€ A íƒ€ì¼(128Ã—8=1024 ì›ì†Œ) ë¡œë“œ ì‹œ ìŠ¤ë ˆë“œë‹¹ ë¡œë“œ íšŸìˆ˜ëŠ”?',o:['1íšŒ','2íšŒ','4íšŒ','8íšŒ'],a:2,b:'Ap',e:'1024 ì›ì†Œ / 256 ìŠ¤ë ˆë“œ = 4 ì›ì†Œ/ìŠ¤ë ˆë“œ. A_TILE_ROW_STRIDE=32, 128/32=4ë²ˆ ë°˜ë³µì…ë‹ˆë‹¤.'},
  {q:'A_TILE_ROW_STRIDE = 256/8 = 32ì˜ ì˜ë¯¸ëŠ”?',o:['32ê°œ ìŠ¤ë ˆë“œê°€ í•œ í–‰ì„ ë¡œë“œ','256 ìŠ¤ë ˆë“œë¥¼ 8ì—´ë¡œ ë‚˜ëˆ„ë©´ 32í–‰ í•œ ë²ˆì— ë¡œë“œ','32ë°”ì´íŠ¸ ì •ë ¬ ë‹¨ìœ„','BKì˜ 4ë°°'],a:1,b:'An',e:'256 ìŠ¤ë ˆë“œë¥¼ BK=8 ì—´ë¡œ ë‚˜ëˆ„ë©´ í•œ ë²ˆì— 32í–‰ì„ ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 128/32=4ë²ˆ ë°˜ë³µí•˜ë©´ ì „ì²´ íƒ€ì¼ ì™„ì„±.'},
  {q:'ë ˆì§€ìŠ¤í„° 255ê°œ ì´ˆê³¼ ì‹œ ë°œìƒí•˜ëŠ” í˜„ìƒì€?',o:['ì»´íŒŒì¼ ì—ëŸ¬','ë ˆì§€ìŠ¤í„° ìŠ¤í•„ë§ (LDL/STL ëª…ë ¹ì–´)','ìë™ìœ¼ë¡œ ê³µìœ  ë©”ëª¨ë¦¬ ì‚¬ìš©','ì„±ëŠ¥ì— ì˜í–¥ ì—†ìŒ'],a:1,b:'An',e:'ë ˆì§€ìŠ¤í„°ê°€ ë¶€ì¡±í•˜ë©´ ë¡œì»¬ ë©”ëª¨ë¦¬(DRAM)ë¡œ ìŠ¤í•„ë§ë©ë‹ˆë‹¤. SASSì—ì„œ LDL/STL ëª…ë ¹ì–´ë¡œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.'},
  {q:'ì ìœ ìœ¨ 25%ì¸ Level 3ê°€ ì ìœ ìœ¨ 50%ì¸ Level 2ë³´ë‹¤ ë¹ ë¥¸ ì´ìœ ëŠ”?',o:['ìºì‹œê°€ ë” ì»¤ì„œ','ì‚°ìˆ  ê°•ë„ 8ë°° + 64ê°œ ë…ë¦½ FMAì˜ ë†’ì€ ILP','ì›Œí”„ê°€ ë” ë§ì•„ì„œ','ë©”ëª¨ë¦¬ ëŒ€ì—­í­ì´ ë” ë†’ì•„ì„œ'],a:1,b:'Ev',e:'AI 8ë°° í–¥ìƒ + 64ê°œ ë…ë¦½ FMAì— ì˜í•œ ILPê°€ ë‚®ì€ ì ìœ ìœ¨(TLP)ì„ ì™„ì „íˆ ë³´ìƒí•©ë‹ˆë‹¤.'},
  {q:'TM=4, TN=16ìœ¼ë¡œ ë³€ê²½ ì‹œ ì‚°ìˆ  ê°•ë„ ë³€í™”ëŠ”?',o:['AI = 2.0 (ë³€í™” ì—†ìŒ)','AI = 1.6 (20% ê°ì†Œ)','AI = 2.5 (25% ì¦ê°€)','AI = 4.0 (2ë°° ì¦ê°€)'],a:1,b:'Cr',e:'AI = 4Ã—16/(2Ã—(4+16)) = 64/40 = 1.6 FLOP/byte. ì •ì‚¬ê°í˜•(8Ã—8)ì´ ìµœì ì…ë‹ˆë‹¤.'},
],
'08': [
  {q:'ë”ë¸” ë²„í¼ë§ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê³µìœ  ë©”ëª¨ë¦¬ ë²„í¼ ì„¸íŠ¸ ìˆ˜ëŠ”?',o:['1','2','3','4'],a:1,b:'R',e:'ë”ë¸” ë²„í¼ë§ì€ ì´ë¦„ ê·¸ëŒ€ë¡œ 2ê°œì˜ ë²„í¼ ì„¸íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.'},
  {q:'ì†Œí”„íŠ¸ì›¨ì–´ íŒŒì´í”„ë¼ì´ë‹ì˜ í•µì‹¬ ì›ë¦¬ëŠ”?',o:['ë©”ëª¨ë¦¬ë¥¼ ë” ë§ì´ ì‚¬ìš©í•˜ì—¬ ì ‘ê·¼ íšŸìˆ˜ë¥¼ ì¤„ì¸ë‹¤','ë£¨í”„ë¥¼ ì–¸ë¡¤í•˜ì—¬ ë¶„ê¸° ì˜¤ë²„í—¤ë“œë¥¼ ì œê±°í•œë‹¤','ë©”ëª¨ë¦¬ ë¡œë“œì™€ ì—°ì‚°ì„ ì‹œê°„ì ìœ¼ë¡œ ì¤‘ì²©ì‹œì¼œ ë ˆì´í„´ì‹œë¥¼ ìˆ¨ê¸´ë‹¤','ê³µìœ  ë©”ëª¨ë¦¬ë¥¼ ë ˆì§€ìŠ¤í„°ë¡œ ëŒ€ì²´í•œë‹¤'],a:2,b:'U',e:'í•µì‹¬ì€ ë¡œë“œ(ë‹¤ìŒ íƒ€ì¼)ì™€ ì—°ì‚°(í˜„ì¬ íƒ€ì¼)ì„ ë™ì‹œì— ìˆ˜í–‰í•˜ì—¬ ë©”ëª¨ë¦¬ ë ˆì´í„´ì‹œë¥¼ ìˆ¨ê¸°ëŠ” ê²ƒì…ë‹ˆë‹¤.'},
  {q:'kt=0,1,2,3ì—ì„œ curr_buf ê°’ì˜ íŒ¨í„´ì€?',o:['0,0,0,0','0,1,0,1','0,1,2,0','1,0,1,0'],a:1,b:'Ap',e:'curr_buf = kt % 2. kt=0â†’0, kt=1â†’1, kt=2â†’0, kt=3â†’1. 0ê³¼ 1ì´ êµëŒ€í•©ë‹ˆë‹¤.'},
  {q:'í”„ë¡¤ë¡œê·¸ë¥¼ ìƒëµí•˜ë©´ ë°œìƒí•˜ëŠ” ë¬¸ì œëŠ”?',o:['ì»´íŒŒì¼ ì—ëŸ¬','ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ê³µìœ  ë©”ëª¨ë¦¬ë¡œ ì—°ì‚°í•˜ì—¬ ì˜ëª»ëœ ê²°ê³¼','ì„±ëŠ¥ì´ ì•½ê°„ ì €í•˜','ë‹¤ìŒ íƒ€ì¼ ë¡œë“œê°€ ì‹¤íŒ¨'],a:1,b:'An',e:'í”„ë¡¤ë¡œê·¸ê°€ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ ì—°ì‚° ì‹œ ë²„í¼ì— ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ì–´ ì˜ëª»ëœ ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤.'},
  {q:'Long Scoreboard ê°ì†Œ + Math Pipe Throttle ì¦ê°€ì˜ ì˜ë¯¸ëŠ”?',o:['ì„±ëŠ¥ ì €í•˜ ì‹ í˜¸','ë©”ëª¨ë¦¬ ì˜¤ë¥˜ ë°œìƒ','GPUê°€ ê¸°ë‹¤ë¦¼ì—ì„œ ì—°ì‚°ìœ¼ë¡œ ì‹œê°„ ì¬ë¶„ë°° â€” ê¸ì •ì  ì‹ í˜¸','ì—´ ì œí•œì— ë„ë‹¬'],a:2,b:'An',e:'ë©”ëª¨ë¦¬ ëŒ€ê¸°(Long Scoreboard)ê°€ ì¤„ê³  ì—°ì‚°(Math Pipe)ì´ ëŠ˜ì—ˆìœ¼ë¯€ë¡œ íŒŒì´í”„ë¼ì´ë‹ì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.'},
  {q:'ê³µìœ  ë©”ëª¨ë¦¬ 2ë°° ì¦ê°€ê°€ ì ìœ ìœ¨ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì€?',o:['ì ìœ ìœ¨ì´ ì ˆë°˜ìœ¼ë¡œ ê°ì†Œ','A100ì—ì„œ 17KB/164KB=10.4%ë¡œ ë³‘ëª© ê°€ëŠ¥ì„± ë‚®ìŒ','ì ìœ ìœ¨ì— ì˜í–¥ ì—†ìŒ','ì ìœ ìœ¨ì´ ë‘ ë°°ë¡œ ì¦ê°€'],a:1,b:'Ev',e:'17 KBëŠ” A100 SMë‹¹ 164 KBì˜ 10.4%ë¡œ, ë ˆì§€ìŠ¤í„°ê°€ ì£¼ëœ ì ìœ ìœ¨ ì œí•œ ìš”ì¸ì´ë¼ë©´ ì˜í–¥ì´ ì ìŠµë‹ˆë‹¤.'},
  {q:'K%BKâ‰ 0ì¼ ë•Œ ì—í•„ë¡œê·¸ì—ì„œ í•´ì•¼ í•  ì²˜ë¦¬ëŠ”?',o:['ë‚˜ë¨¸ì§€ë¥¼ ë¬´ì‹œ','ë©”ì¸ ë£¨í”„ì—ì„œ ì™„ì „ íƒ€ì¼ ì²˜ë¦¬ í›„ ë‚˜ë¨¸ì§€ë¥¼ ë³„ë„ ì²˜ë¦¬','Kë¥¼ BKì˜ ë°°ìˆ˜ë¡œ íŒ¨ë”©','ì—ëŸ¬ë¥¼ ë°˜í™˜'],a:1,b:'Cr',e:'ì—í•„ë¡œê·¸ì—ì„œ ë‚˜ë¨¸ì§€ K%BKê°œ ì—´ì„ ë³„ë„ë¡œ ë¡œë“œí•˜ê³  ì—°ì‚°í•˜ì—¬ ì •í™•ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.'},
],
'09': [
  {q:'cp.asyncì˜ ìµœì†Œ Compute CapabilityëŠ”?',o:['7.0 (Volta)','7.5 (Turing)','8.0 (Ampere)','9.0 (Hopper)'],a:2,b:'R',e:'cp.async ëª…ë ¹ì–´ëŠ” Compute Capability 8.0 (Ampere) ì´ìƒì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.'},
  {q:'SASSì—ì„œ cp.asyncê°€ ë³€í™˜ë˜ëŠ” ëª…ë ¹ì–´ ì´ë¦„ì€?',o:['LDG.E.128','LDGSTS','STS.128','MEMBAR'],a:1,b:'R',e:'cp.asyncëŠ” SASSì—ì„œ LDGSTS (Load Global Store Shared) ëª…ë ¹ì–´ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.'},
  {q:'cp.asyncê°€ ë ˆì§€ìŠ¤í„°ë¥¼ ìš°íšŒí•˜ëŠ” ì´ì  2ê°€ì§€ ì¤‘ í•´ë‹¹í•˜ì§€ ì•ŠëŠ” ê²ƒì€?',o:['ë ˆì§€ìŠ¤í„° ì••ë ¥ ê°ì†Œ','Long Scoreboard ìŠ¤í†¨ ì œê±°','ì—°ì‚° ì²˜ë¦¬ëŸ‰ ì¦ê°€','ê³µìœ  ë©”ëª¨ë¦¬ ìš©ëŸ‰ ê°ì†Œ'],a:3,b:'U',e:'ë ˆì§€ìŠ¤í„° ìš°íšŒì˜ ì´ì ì€ (1) ë ˆì§€ìŠ¤í„° ì••ë ¥ ê°ì†Œâ†’ì ìœ ìœ¨ í–¥ìƒ (2) ë©”ëª¨ë¦¬ ì˜ì¡´ì„± ì œê±°â†’ìŠ¤í†¨ ê°ì†Œì…ë‹ˆë‹¤.'},
  {q:'cp_async_wait_group(2) í˜¸ì¶œ ì‹œ ë³´ì¥í•˜ëŠ” ê²ƒì€?',o:['ëª¨ë“  ê·¸ë£¹ ì™„ë£Œ','ë¯¸ì™„ë£Œ ê·¸ë£¹ì´ 2ê°œ ì´í•˜','ì •í™•íˆ 2ê°œ ê·¸ë£¹ ì™„ë£Œ','2ë²ˆì§¸ ê·¸ë£¹ë§Œ ì™„ë£Œ'],a:1,b:'Ap',e:'wait_group(N)ì€ ë¯¸ì™„ë£Œ ê·¸ë£¹ì´ ìµœëŒ€ Nê°œê°€ ë  ë•Œê¹Œì§€ ëŒ€ê¸°í•©ë‹ˆë‹¤. ê°€ì¥ ì˜¤ë˜ëœ ê·¸ë£¹ì˜ ì™„ë£Œê°€ ë³´ì¥ë©ë‹ˆë‹¤.'},
  {q:'NUM_STAGES=3, kt=5ì¼ ë•Œ curr_stageëŠ”?',o:['0','1','2','5'],a:2,b:'Ap',e:'curr_stage = kt % NUM_STAGES = 5 % 3 = 2ì…ë‹ˆë‹¤.'},
  {q:'commit_group ì—†ì´ wait_group(2) í˜¸ì¶œ ì‹œ ë¬¸ì œëŠ”?',o:['ì»´íŒŒì¼ ì—ëŸ¬','ê·¸ë£¹ì´ í˜•ì„±ë˜ì§€ ì•Šì•„ íŠ¹ì • íƒ€ì¼ ì™„ë£Œë¥¼ ë³´ì¥í•  ìˆ˜ ì—†ìŒ','ì„±ëŠ¥ë§Œ ì•½ê°„ ì €í•˜','ì•„ë¬´ ë¬¸ì œ ì—†ìŒ'],a:1,b:'An',e:'commit_group ì—†ì´ëŠ” ê·¸ë£¹ ê²½ê³„ê°€ ë¯¸ì •ì˜ë˜ì–´ wait_groupì˜ ì˜ë¯¸ê°€ ìƒì‹¤ë©ë‹ˆë‹¤.'},
  {q:'íŠ¸ë¦¬í”Œ ë²„í¼ë§ì´ ë”ë¸”ë³´ë‹¤ ë ˆì´í„´ì‹œ ì€ë‹‰ì— ìœ ë¦¬í•œ ì´ìœ ëŠ”?',o:['ë©”ëª¨ë¦¬ê°€ ë” ì»¤ì„œ','íŒŒì´í”„ë¼ì¸ ê¹Šì´ê°€ 2ë¡œ ì¦ê°€í•˜ì—¬ ë” ê¸´ ë¡œë“œë¥¼ ìˆ¨ê¸¸ ìˆ˜ ìˆìŒ','ì—°ì‚°ì´ ë¹¨ë¼ì ¸ì„œ','ë™ê¸°í™”ê°€ ì¤„ì–´ì„œ'],a:1,b:'An',e:'íŒŒì´í”„ë¼ì¸ ê¹Šì´ê°€ 1(ë”ë¸”)â†’2(íŠ¸ë¦¬í”Œ)ë¡œ ì¦ê°€. T_load > 2Ã—T_computeê°€ ì•„ë‹Œ í•œ ìœ íœ´ ì‹œê°„ì´ ì—†ìŠµë‹ˆë‹¤.'},
  {q:'NUM_STAGES=4ì˜ ë‹¨ì ì€?',o:['ì—°ì‚° ì†ë„ ì €í•˜','ê³µìœ  ë©”ëª¨ë¦¬ ~34.9KB ì‚¬ìš©ìœ¼ë¡œ ì ìœ ìœ¨ ê°ì†Œ ê°€ëŠ¥','ì½”ë“œ ë³µì¡ë„ë§Œ ì¦ê°€','ë‹¨ì  ì—†ìŒ'],a:1,b:'Ev',e:'ì¥ì : íŒŒì´í”„ë¼ì¸ ê¹Šì´ 3. ë‹¨ì : ê³µìœ  ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€. ë³´í†µ NUM_STAGES=3ì´ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.'},
  {q:'Ampere ë¯¸ë§Œ GPUë¥¼ ìœ„í•œ í´ë°± ì „ëµì€?',o:['cp.asyncë¥¼ ë¬´ì‹œ','#if __CUDA_ARCH__ >= 800 ë¶„ê¸°ë¡œ ë”ë¸” ë²„í¼ë§+LDG/STS í´ë°±','ì—ëŸ¬ë¥¼ ë°˜í™˜','cuBLASë¥¼ í˜¸ì¶œ'],a:1,b:'Cr',e:'ì¡°ê±´ë¶€ ì»´íŒŒì¼ë¡œ Ampere ì´ìƒì€ cp.async, ë¯¸ë§Œì€ ë”ë¸” ë²„í¼ë§+ì¼ë°˜ ë¡œë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.'},
  {q:'BKë¥¼ 8â†’16ìœ¼ë¡œ ë³€ê²½ ì‹œ ê³µìœ  ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì€?',o:['ì•½ 17 KB','ì•½ 26 KB','ì•½ 35 KB','ì•½ 51 KB'],a:3,b:'Cr',e:'3 Ã— (128Ã—(16+1) + 16Ã—(128+1)) Ã— 4 â‰ˆ 3 Ã— (2176+2064) Ã— 4 â‰ˆ 50,880 ë°”ì´íŠ¸ â‰ˆ ì•½ 51 KBì…ë‹ˆë‹¤.'},
],
'10': [
  {q:'SOL ë¶„ì„ì˜ ë‘ ê°€ì§€ í•µì‹¬ ì¶•ì€?',o:['ì ìœ ìœ¨ê³¼ IPC','SM Throughput(%)ê³¼ Memory Throughput(%)','ë ˆì´í„´ì‹œì™€ ëŒ€ì—­í­','ë ˆì§€ìŠ¤í„°ì™€ ê³µìœ  ë©”ëª¨ë¦¬'],a:1,b:'R',e:'Speed Of Light ë¶„ì„ì€ SM ì²˜ë¦¬ëŸ‰ê³¼ ë©”ëª¨ë¦¬ ì²˜ë¦¬ëŸ‰ì˜ ë‘ ì¶•ìœ¼ë¡œ ì„±ëŠ¥ ë³‘ëª©ì„ ì§„ë‹¨í•©ë‹ˆë‹¤.'},
  {q:'SMê³¼ Memory Throughputì´ ëª¨ë‘ ë‚®ì€ Latency Boundì˜ ì›ì¸ì€?',o:['í•˜ë“œì›¨ì–´ ê³ ì¥','ìš”ì²­â†’ëŒ€ê¸°â†’ì—°ì‚°ì´ ì§ë ¬ ì‹¤í–‰ë˜ì–´ ëŒ€ì—­í­ ë¯¸í¬í™”','ìºì‹œê°€ ë„ˆë¬´ ì‘ì•„ì„œ','ë¸”ë¡ ìˆ˜ê°€ ë¶€ì¡±í•´ì„œ'],a:1,b:'U',e:'ë ˆì´í„´ì‹œ ë°”ìš´ë“œëŠ” ë©”ëª¨ë¦¬ ìš”ì²­ í›„ ëŒ€ê¸°í•˜ëŠ” ì§ë ¬ íŒ¨í„´ìœ¼ë¡œ, ëŒ€ì—­í­ë„ ì—°ì‚° ìœ ë‹›ë„ ì¶©ë¶„íˆ í™œìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'},
  {q:'í”¼í¬ 19,500 GFLOP/s, 2,039 GB/sì—ì„œ ë¦¿ì§€ í¬ì¸íŠ¸ ì‚°ìˆ  ê°•ë„ëŠ”?',o:['ì•½ 4.78','ì•½ 9.56','ì•½ 19.12','ì•½ 38.24'],a:1,b:'Ap',e:'ë¦¿ì§€ í¬ì¸íŠ¸ = 19,500 / 2,039 â‰ˆ 9.56 FLOP/byteì…ë‹ˆë‹¤.'},
  {q:'M=N=K=4096 SGEMMì´ 3.2msì— ì™„ë£Œ ì‹œ GFLOP/sëŠ”?',o:['ì•½ 21,475','ì•½ 42,950','ì•½ 85,900','ì•½ 137,440'],a:1,b:'Ap',e:'2Ã—4096Â³ / 0.0032 = 137,438,953,472 / 0.0032 â‰ˆ 42,950 GFLOP/sì…ë‹ˆë‹¤.'},
  {q:'SASSì—ì„œ LDGSTS ëŒ€ì‹  LDG+STSê°€ ë³´ì´ë©´?',o:['ì •ìƒ ë™ì‘','cp.async ë¯¸ì‘ë™ â€” ë ˆì§€ìŠ¤í„° ê²½ìœ , ë¹„ë™ê¸° ì´ì  ìƒì‹¤','ì»´íŒŒì¼ëŸ¬ ìµœì í™”ì˜ ê²°ê³¼','ë” ë¹ ë¥¸ ì½”ë“œ'],a:1,b:'An',e:'LDGSTSê°€ ì•„ë‹Œ LDG+STSëŠ” cp.asyncê°€ ì ìš©ë˜ì§€ ì•Šì•˜ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.'},
  {q:'Long Scoreboard 60% + Wait 25%ì¼ ë•Œ ìƒíƒœì™€ ê°œì„  ë°©í–¥ì€?',o:['ì •ìƒ â€” ê°œì„  ë¶ˆí•„ìš”','í•©ì³ 85% ìœ íœ´ â€” ë”ë¸” ë²„í¼ë§/cp.async í•„ìš”','ë©”ëª¨ë¦¬ ì˜¤ë¥˜ â€” ë””ë²„ê¹… í•„ìš”','ì—°ì‚° ë°”ìš´ë“œ â€” ì•Œê³ ë¦¬ì¦˜ ë³€ê²½ í•„ìš”'],a:1,b:'An',e:'85%ê°€ ìœ íœ´ ìƒíƒœì´ë¯€ë¡œ ì‹¬ê°í•œ ë ˆì´í„´ì‹œ ë°”ìš´ë“œì…ë‹ˆë‹¤. í”„ë¦¬í˜ì¹˜, ë”ë¸” ë²„í¼ë§, cp.asyncê°€ í•„ìš”í•©ë‹ˆë‹¤.'},
  {q:'ì ìœ ìœ¨ 25% ë ˆì§€ìŠ¤í„° ë¸”ë¡œí‚¹ì´ ì ìœ ìœ¨ 62% íƒ€ì¼ë§ë³´ë‹¤ 3ë°° ë¹ ë¥¸ ì´ìœ ëŠ”?',o:['ì ìœ ìœ¨ì´ ë†’ì„ìˆ˜ë¡ í•­ìƒ ì¢‹ì€ ê²ƒì€ ì•„ë‹ˆë¯€ë¡œ, ì‚°ìˆ  ê°•ë„ 16ë°° + ILP','ìºì‹œ ì ì¤‘ë¥ ì´ ë” ë†’ì•„ì„œ','ë©”ëª¨ë¦¬ ëŒ€ì—­í­ì„ ë” ì“°ë¯€ë¡œ','ì›Œí”„ ìŠ¤ì¼€ì¤„ë§ì´ ë” íš¨ìœ¨ì ì´ë¯€ë¡œ'],a:0,b:'Ev',e:'ì‚°ìˆ  ê°•ë„ 16ë°° í–¥ìƒ + 128ê°œ ë…ë¦½ FMAì˜ ILP + ë©”ëª¨ë¦¬ íŠ¸ë˜í”½ ê°ì†Œê°€ í•µì‹¬ì…ë‹ˆë‹¤.'},
  {q:'cuBLAS 90% ì´í›„ ìˆ˜ìµ ì²´ê°ì´ ì‹¬í•œ ì´ìœ ëŠ”?',o:['í•˜ë“œì›¨ì–´ í•œê³„ì— ë„ë‹¬í•´ì„œ','ì•”ë‹¬ì˜ ë²•ì¹™ + cuBLAS ë¹„ê³µê°œ ìµœì í™” + íŠ¸ë ˆì´ë“œì˜¤í”„ ë³µì¡í™”','ìµœì í™” ê¸°ë²•ì´ ë” ì—†ì–´ì„œ','ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•´ì„œ'],a:1,b:'Ev',e:'90% ì´í›„ì—ëŠ” ì•”ë‹¬ì˜ ë²•ì¹™, HW í•œê³„, cuBLAS ë¹„ê³µê°œ ìµœì í™”, ë³µì¡í•œ íŠ¸ë ˆì´ë“œì˜¤í”„ë¡œ ìˆ˜ìµ ì²´ê°ì´ ì‹¬í•©ë‹ˆë‹¤.'},
],
};

// --- Code Tracing Data ---
// Each: {code, steps:[{prompt, answer(number), hint}]}
const CODE_TRACES = {
'04': {
  title:'ë‚˜ì´ë¸Œ SGEMM â€” ìŠ¤ë ˆë“œ ì¸ë±ìŠ¤ ê³„ì‚°',
  code:`extern "C" __global__ void sgemm_naive(
    const float* A, const float* B, float* C,
    int M, int N, int K, int lda, int ldb, int ldc,
    float alpha, float beta)
{
    int row = blockIdx.y * blockDim.y + threadIdx.y;
    int col = blockIdx.x * blockDim.x + threadIdx.x;
    if (row < M && col < N) {
        float sum = 0.0f;
        for (int k = 0; k < K; ++k)
            sum += A[row * lda + k] * B[k * ldb + col];
        C[row * ldc + col] = alpha * sum + beta * C[row*ldc+col];
    }
}`,
  steps:[
    {prompt:'blockIdx.y=2, blockDim.y=16, threadIdx.y=5 ì¼ ë•Œ row = ?',answer:37,hint:'row = blockIdx.y Ã— blockDim.y + threadIdx.y'},
    {prompt:'blockIdx.x=1, blockDim.x=16, threadIdx.x=10 ì¼ ë•Œ col = ?',answer:26,hint:'col = blockIdx.x Ã— blockDim.x + threadIdx.x'},
    {prompt:'row=37, lda=64, k=3 ì¼ ë•Œ Aì˜ ì¸ë±ìŠ¤ (row*lda+k) = ?',answer:2371,hint:'37 Ã— 64 + 3'},
    {prompt:'k=3, ldb=128, col=26 ì¼ ë•Œ Bì˜ ì¸ë±ìŠ¤ (k*ldb+col) = ?',answer:410,hint:'3 Ã— 128 + 26'},
    {prompt:'M=4096, ë¸”ë¡=16Ã—16ì¼ ë•Œ yì¶• ê·¸ë¦¬ë“œ í¬ê¸° ((M+15)/16) = ?',answer:256,hint:'(4096 + 15) / 16 = 256'},
  ]
},
'05': {
  title:'ì½”ì–¼ë ˆì‹± SGEMM â€” ë²¡í„°í™” ë£¨í”„',
  code:`#define FETCH_FLOAT4(p) (reinterpret_cast<const float4*>(&(p))[0])

int K_vec = K / 4;
float sum = 0.0f;
for (int k = 0; k < K_vec; ++k) {
    float4 a_vec = FETCH_FLOAT4(A[row * lda + k * 4]);
    float b0 = B[(k*4 + 0) * ldb + col];
    float b1 = B[(k*4 + 1) * ldb + col];
    sum += a_vec.x * b0 + a_vec.y * b1
         + a_vec.z * B[(k*4+2)*ldb+col]
         + a_vec.w * B[(k*4+3)*ldb+col];
}`,
  steps:[
    {prompt:'K=1024ì¼ ë•Œ K_vec = K/4 = ?',answer:256,hint:'1024 / 4'},
    {prompt:'k=10, lda=1024ì¼ ë•Œ Aì˜ float4 ì‹œì‘ ì¸ë±ìŠ¤ (row=0 ê°€ì •): k*4 = ?',answer:40,hint:'10 Ã— 4 = 40'},
    {prompt:'k=5ì¼ ë•Œ B ì ‘ê·¼ì˜ ì²« ë²ˆì§¸ í–‰ ì¸ë±ìŠ¤ (k*4+0) = ?',answer:20,hint:'5 Ã— 4 + 0 = 20'},
    {prompt:'float4 ë¡œë“œ í•˜ë‚˜ê°€ ì „ì†¡í•˜ëŠ” ë°”ì´íŠ¸ ìˆ˜ëŠ”?',answer:16,hint:'float 4ê°œ Ã— 4ë°”ì´íŠ¸ = 16ë°”ì´íŠ¸'},
  ]
},
'06': {
  title:'íƒ€ì¼ë§ SGEMM â€” ë±…í¬ ì¶©ëŒ ë¶„ì„',
  code:`#define BLOCK_SIZE 16
#define SMEM_PADDING 1   // ë±…í¬ ì¶©ëŒ ë°©ì§€

__shared__ float A_tile[BLOCK_SIZE][BLOCK_SIZE + SMEM_PADDING]; // [16][17]

// ë±…í¬ = (ë°”ì´íŠ¸ì£¼ì†Œ / 4) % 32
// A_tile[ty][k]ì˜ ë°”ì´íŠ¸ ì˜¤í”„ì…‹ = (ty * 17 + k) * 4
// ë”°ë¼ì„œ ë±…í¬ = (ty * 17 + k) % 32`,
  steps:[
    {prompt:'íŒ¨ë”© ì—†ì´ A_tile[16][16]ì¼ ë•Œ, A_tile[0][5]ì˜ ë±…í¬ = (0Ã—16+5)%32 = ?',answer:5,hint:'(0 Ã— 16 + 5) % 32'},
    {prompt:'íŒ¨ë”© ì—†ì´ A_tile[2][5]ì˜ ë±…í¬ = (2Ã—16+5)%32 = ?',answer:5,hint:'(32 + 5) % 32 = 37 % 32 = 5. ì¶©ëŒ!'},
    {prompt:'íŒ¨ë”© ìˆìŒ: A_tile[0][5]ì˜ ë±…í¬ = (0Ã—17+5)%32 = ?',answer:5,hint:'(0 Ã— 17 + 5) % 32'},
    {prompt:'íŒ¨ë”© ìˆìŒ: A_tile[2][5]ì˜ ë±…í¬ = (2Ã—17+5)%32 = ?',answer:7,hint:'(34 + 5) % 32 = 39 % 32 = 7. ì¶©ëŒ ì—†ìŒ!'},
    {prompt:'K=48, BLOCK_SIZE=16ì¼ ë•Œ íƒ€ì¼ ë°˜ë³µ íšŸìˆ˜ ceil(48/16) = ?',answer:3,hint:'(48 + 15) / 16 = 3'},
  ]
},
'07': {
  title:'ë ˆì§€ìŠ¤í„° ë¸”ë¡œí‚¹ â€” ì™¸ì  ì—°ì‚°',
  code:`#define BM 128
#define BN 128
#define BK 8
#define TM 8
#define TN 8

float reg_C[TM][TN] = {{0.0f}};  // 64 accumulators
float reg_A[TM], reg_B[TN];       // 8 + 8 registers

// thread_row_start = ty * TM
// thread_col_start = tx * TN
// A_TILE_ROW_STRIDE = blockDim.x * blockDim.y / BK`,
  steps:[
    {prompt:'TM Ã— TN = í•œ ìŠ¤ë ˆë“œì˜ ëˆ„ì  ë ˆì§€ìŠ¤í„° ìˆ˜ = ?',answer:64,hint:'8 Ã— 8 = 64'},
    {prompt:'ty=5ì¼ ë•Œ thread_row_start = ty Ã— TM = ?',answer:40,hint:'5 Ã— 8 = 40'},
    {prompt:'tx=3ì¼ ë•Œ thread_col_start = tx Ã— TN = ?',answer:24,hint:'3 Ã— 8 = 24'},
    {prompt:'blockDim = 16Ã—16 = 256. A_TILE_ROW_STRIDE = 256/BK = 256/8 = ?',answer:32,hint:'256 / 8'},
    {prompt:'í•œ BK ìŠ¤í…ì—ì„œì˜ ì´ FMA ìˆ˜: TM Ã— TN = ?',answer:64,hint:'8 Ã— 8 = 64'},
    {prompt:'ì™¸ì ì—ì„œ reg_A ë¡œë“œ + reg_B ë¡œë“œ = ê³µìœ  ë©”ëª¨ë¦¬ ì ‘ê·¼ ì´ íšŸìˆ˜ = ?',answer:16,hint:'TM + TN = 8 + 8 = 16'},
  ]
},
'08': {
  title:'ë”ë¸” ë²„í¼ë§ â€” íŒŒì´í”„ë¼ì¸ ì¶”ì ',
  code:`// Prologue: Load tile 0 into buffer[0]
load_tile(0, 0);
__syncthreads();

for (int kt = 0; kt < num_k_tiles; ++kt) {
    int curr_buf = kt % 2;
    int next_buf = (kt + 1) % 2;
    if (kt + 1 < num_k_tiles)
        load_tile(next_buf, kt + 1);  // prefetch
    compute_tile(curr_buf);            // compute
    __syncthreads();
}`,
  steps:[
    {prompt:'kt=0ì¼ ë•Œ curr_buf = 0%2 = ?',answer:0,hint:'0 % 2 = 0'},
    {prompt:'kt=0ì¼ ë•Œ next_buf = (0+1)%2 = ?',answer:1,hint:'1 % 2 = 1'},
    {prompt:'kt=3ì¼ ë•Œ curr_buf = 3%2 = ?',answer:1,hint:'3 % 2 = 1'},
    {prompt:'K=32, BK=8ì¼ ë•Œ num_k_tiles = K/BK = ?',answer:4,hint:'32 / 8 = 4'},
    {prompt:'T_load=400, T_comp=200, N=4ì¼ ë•Œ ì‹±ê¸€ë²„í¼ ì´ ì‚¬ì´í´ = NÃ—(T_load+T_comp) = ?',answer:2400,hint:'4 Ã— (400+200) = 2400'},
  ]
},
'09': {
  title:'ë¹„ë™ê¸° ë³µì‚¬ â€” íŠ¸ë¦¬í”Œ ë²„í¼ ìŠ¤í…Œì´ì§€',
  code:`#define NUM_STAGES 3

for (int kt = 0; kt < num_k_tiles; ++kt) {
    int curr_stage = kt % NUM_STAGES;
    int prefetch_tile = kt + NUM_STAGES - 1;
    int prefetch_stage = prefetch_tile % NUM_STAGES;

    if (prefetch_tile < num_k_tiles)
        async_load(prefetch_stage, prefetch_tile);

    cp_async_wait_group(NUM_STAGES - 1);  // wait_group(2)
    __syncthreads();
    compute(curr_stage);
}`,
  steps:[
    {prompt:'kt=0ì¼ ë•Œ curr_stage = 0%3 = ?',answer:0,hint:'0 % 3 = 0'},
    {prompt:'kt=4ì¼ ë•Œ curr_stage = 4%3 = ?',answer:1,hint:'4 % 3 = 1'},
    {prompt:'kt=2ì¼ ë•Œ prefetch_tile = 2+3-1 = ?',answer:4,hint:'2 + 2 = 4'},
    {prompt:'prefetch_tile=7ì¼ ë•Œ prefetch_stage = 7%3 = ?',answer:1,hint:'7 % 3 = 1'},
    {prompt:'NUM_STAGES=3ì¼ ë•Œ wait_groupì˜ ì¸ìˆ˜ = NUM_STAGES-1 = ?',answer:2,hint:'3 - 1 = 2'},
  ]
},
};

// --- Pre-Review Questions (Game A: Memory Challenge) ---
// Each module has 3 questions from previous modules
const REVIEWS = {
'04': [
  {q:'SGEMM ì´ FLOP ìˆ˜ ê³µì‹ì€?',o:['MÃ—NÃ—K','2Ã—MÃ—NÃ—K','MÃ—N+K','2Ã—(M+N)Ã—K'],a:1},
  {q:'Row-majorì—ì„œ A[i][j]ì˜ 1ì°¨ì› ì¸ë±ìŠ¤ëŠ”?',o:['i+jÃ—lda','iÃ—lda+j','jÃ—lda+i','iÃ—j+lda'],a:1},
  {q:'ê¸€ë¡œë²Œ ë©”ëª¨ë¦¬ ì ‘ê·¼ ì§€ì—°ì‹œê°„ì€ ëŒ€ëµ?',o:['1-5 ì‚¬ì´í´','20-30 ì‚¬ì´í´','400-800 ì‚¬ì´í´','10,000+ ì‚¬ì´í´'],a:2},
],
'05': [
  {q:'ì›Œí”„(Warp)ì˜ í¬ê¸°ëŠ”?',o:['16 ìŠ¤ë ˆë“œ','32 ìŠ¤ë ˆë“œ','64 ìŠ¤ë ˆë“œ','128 ìŠ¤ë ˆë“œ'],a:1},
  {q:'ë‚˜ì´ë¸Œ ì»¤ë„ì´ ëŠë¦° ì£¼ëœ ì´ìœ ê°€ ì•„ë‹Œ ê²ƒì€?',o:['ë¹„ì½”ì–¼ë ˆì‹±','ë°ì´í„° ì¬ì‚¬ìš© ì—†ìŒ','ë¸”ë¡ í¬ê¸°ê°€ í¼','ë‚®ì€ ì‚°ìˆ  ê°•ë„'],a:2},
  {q:'A100 ê¸€ë¡œë²Œ ë©”ëª¨ë¦¬ ì´ë¡ ì  ëŒ€ì—­í­ì€?',o:['ì•½ 500 GB/s','ì•½ 1 TB/s','ì•½ 2 TB/s','ì•½ 4 TB/s'],a:2},
],
'06': [
  {q:'float4 ë²¡í„°í™” ë¡œë“œì˜ SASS ëª…ë ¹ì–´ëŠ”?',o:['LDG.E','LDG.E.128','STS.128','LDS.E'],a:1},
  {q:'ê³µìœ  ë©”ëª¨ë¦¬ ì ‘ê·¼ ì§€ì—°ì‹œê°„ì€ ëŒ€ëµ?',o:['1 ì‚¬ì´í´','20-30 ì‚¬ì´í´','200 ì‚¬ì´í´','400 ì‚¬ì´í´'],a:1},
  {q:'ë‚˜ì´ë¸Œ ì»¤ë„ì˜ ì‚°ìˆ  ê°•ë„ê°€ ë‚®ì€ ê·¼ë³¸ ì›ì¸ì€?',o:['ë ˆì§€ìŠ¤í„° ë¶€ì¡±','ë°ì´í„° ì¬ì‚¬ìš© ì—†ìŒ','ë¸”ë¡ í¬ê¸° ë¬¸ì œ','ì½”ë“œ ë¹„íš¨ìœ¨'],a:1},
],
'07': [
  {q:'íƒ€ì¼ë§ì—ì„œ ë°ì´í„° ì¬ì‚¬ìš© íŒ©í„°ëŠ”?',o:['2','BK','TILE_SIZE','TMÃ—TN'],a:2},
  {q:'ë±…í¬ ì¶©ëŒ ë°©ì§€ íŒ¨ë”© +1ì˜ ì›ë¦¬ëŠ”?',o:['í–‰ í­ì„ 32ì™€ ì„œë¡œì†Œë¡œ ë§Œë“¦','ë©”ëª¨ë¦¬ ì •ë ¬','ìºì‹œ ì ì¤‘ë¥  í–¥ìƒ','ë ˆì§€ìŠ¤í„° ì ˆì•½'],a:0},
  {q:'ì‚°ìˆ  ê°•ë„ì˜ ë‹¨ìœ„ëŠ”?',o:['GFLOP/s','FLOP/byte','byte/s','ì‚¬ì´í´'],a:1},
],
'08': [
  {q:'ì™¸ì  ë§ˆì´í¬ë¡œì»¤ë„ì—ì„œ reg_A[m]ì˜ ì¬ì‚¬ìš© íšŸìˆ˜ëŠ”?',o:['TM=8ë²ˆ','TN=8ë²ˆ','BK=8ë²ˆ','1ë²ˆ'],a:1},
  {q:'ë±…í¬ ì¶©ëŒ ë°©ì§€ íŒ¨ë”© í¬ê¸°ëŠ”?',o:['+0','+1','+2','+4'],a:1},
  {q:'ë ˆì§€ìŠ¤í„° ë¸”ë¡œí‚¹ì˜ AI ê³µì‹ì—ì„œ TM=TN=8ì¼ ë•Œ AIëŠ”?',o:['0.25','1.0','2.0','4.0'],a:2},
],
'09': [
  {q:'ë”ë¸” ë²„í¼ë§ í”„ë¡¤ë¡œê·¸ì˜ ì—­í• ì€?',o:['ë£¨í”„ ì´ˆê¸°í™”','ì²« íƒ€ì¼ì„ ë¯¸ë¦¬ ë¡œë“œí•˜ì—¬ íŒŒì´í”„ë¼ì¸ ì±„ì›€','ì—ëŸ¬ ì²´í¬','ë©”ëª¨ë¦¬ í• ë‹¹'],a:1},
  {q:'ë ˆì§€ìŠ¤í„° ë¸”ë¡œí‚¹ ì»¤ë„ì˜ ë ˆì§€ìŠ¤í„° ì‚¬ìš©ëŸ‰ì€ ëŒ€ëµ?',o:['ì•½ 30ê°œ','ì•½ 60ê°œ','ì•½ 100-128ê°œ','ì•½ 256ê°œ'],a:2},
  {q:'Long Scoreboard ìŠ¤í†¨ì˜ í•´ê²° ë°©ë²•ì´ ì•„ë‹Œ ê²ƒì€?',o:['í”„ë¦¬í˜ì¹˜','ì ìœ ìœ¨ ë†’ì´ê¸°','cp.async','ë¸”ë¡ í¬ê¸° ì¶•ì†Œ'],a:3},
],
};

// --- Boss Fight Data ---
const BOSSES = {
boss1: {
  name:'ë±…í¬ ì¶©ëŒ ìˆ˜í˜¸ì',module:'06',
  phases:[
    {title:'Phase 1: ì¶©ëŒ ì‹ë³„',
     desc:'ì•„ë˜ ê³µìœ  ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒì—ì„œ ë±…í¬ ì¶©ëŒì´ ë°œìƒí•˜ëŠ” ê²½ìš°ë¥¼ ì°¾ìœ¼ì„¸ìš”.\nfloat smem[8][16] (íŒ¨ë”© ì—†ìŒ), 8ê°œ ìŠ¤ë ˆë“œê°€ smem[tid][4]ë¥¼ ë™ì‹œ ì ‘ê·¼',
     q:'tid=0ê³¼ tid=2ê°€ ì ‘ê·¼í•˜ëŠ” ë±…í¬ê°€ ê°™ì€ê°€? bank=(tidÃ—16+4)%32',
     o:['ë‹¤ë¥´ë‹¤ (ì¶©ëŒ ì—†ìŒ)','ê°™ë‹¤ (ë±…í¬ ì¶©ëŒ!)'],a:1,
     e:'bank(0)=(0Ã—16+4)%32=4, bank(2)=(2Ã—16+4)%32=36%32=4. ê°™ì€ ë±…í¬ 4ì— ë§¤í•‘ë˜ì–´ ì¶©ëŒ!'},
    {title:'Phase 2: íŒ¨ë”© ì ìš©',
     desc:'ë±…í¬ ì¶©ëŒì„ í•´ê²°í•˜ê¸° ìœ„í•œ íŒ¨ë”© ê°’ì€?\nfloat smem[8][16+?]ë¡œ ë³€ê²½í•˜ì—¬ ì¶©ëŒì„ ì œê±°í•˜ë ¤ë©´?',
     q:'16+?ì˜ ê°’ì´ 32ì™€ ì„œë¡œì†Œ(coprime)ê°€ ë˜ëŠ” íŒ¨ë”© ê°’ì€?',
     o:['+0 (16â†’32ì˜ ì•½ìˆ˜)','+ 1 (17â†’32ì™€ ì„œë¡œì†Œ)','+ 2 (18â†’32ì™€ ì„œë¡œì†Œ ì•„ë‹˜)','+ 4 (20â†’32ì˜ ì•½ìˆ˜)'],a:1,
     e:'+1 íŒ¨ë”©ìœ¼ë¡œ í­ì´ 17ì´ ë˜ë©´ 32ì™€ ì„œë¡œì†Œ(GCD(17,32)=1)ì´ë¯€ë¡œ ëª¨ë“  ìŠ¤ë ˆë“œê°€ ë‹¤ë¥¸ ë±…í¬ì— ë§¤í•‘ë©ë‹ˆë‹¤.'},
    {title:'Phase 3: ê²€ì¦',
     desc:'smem[8][17]ì—ì„œ tid=0ê³¼ tid=2ê°€ smem[tid][4] ì ‘ê·¼ ì‹œ',
     q:'ë‘ ë±…í¬ ê°’ì€? bank(0)=(0Ã—17+4)%32=?, bank(2)=(2Ã—17+4)%32=?',
     o:['4, 4 (ì—¬ì „íˆ ì¶©ëŒ)','4, 6 (ì¶©ëŒ í•´ê²°!)','4, 38 (ê³„ì‚° ë¶ˆê°€)','17, 32 (ì¶©ëŒ í•´ê²°!)'],a:1,
     e:'bank(0)=4, bank(2)=(34+4)%32=38%32=6. ì„œë¡œ ë‹¤ë¥¸ ë±…í¬! ì¶©ëŒ í•´ê²° í™•ì¸.'},
  ]
},
boss2: {
  name:'ë ˆì´í„´ì‹œ ë“œë˜ê³¤',module:'08',
  phases:[
    {title:'Phase 1: ìŠ¤í†¨ êµ¬ê°„ ì‹ë³„',
     desc:'ì‹±ê¸€ ë²„í¼ íƒ€ì„ë¼ì¸: [Loadâ‚€][Wait][Compâ‚€][Loadâ‚][Wait][Compâ‚]...\nT_load=100, T_comp=10, íƒ€ì¼ 4ê°œ',
     q:'ì‹±ê¸€ ë²„í¼ì˜ ì´ ì‚¬ì´í´ ìˆ˜ëŠ”?',
     o:['400 ì‚¬ì´í´','410 ì‚¬ì´í´','440 ì‚¬ì´í´','480 ì‚¬ì´í´'],a:2,
     e:'4 Ã— (100+10) = 440 ì‚¬ì´í´. ê° íƒ€ì¼ë§ˆë‹¤ ë¡œë“œ í›„ ì—°ì‚°ì´ ì§ë ¬ ì‹¤í–‰ë©ë‹ˆë‹¤.'},
    {title:'Phase 2: ë”ë¸” ë²„í¼ ë³€í™˜',
     desc:'ë”ë¸” ë²„í¼: í”„ë¡¤ë¡œê·¸ì—ì„œ ì²« íƒ€ì¼ ë¡œë“œ â†’ ë©”ì¸ ë£¨í”„ì—ì„œ ë¡œë“œì™€ ì—°ì‚° ì¤‘ì²©',
     q:'ë”ë¸” ë²„í¼ ì´ ì‚¬ì´í´ ìˆ˜ = T_load + (N-1)Ã—max(T_load, T_comp) + T_compëŠ”?',
     o:['310 ì‚¬ì´í´','400 ì‚¬ì´í´','410 ì‚¬ì´í´','440 ì‚¬ì´í´'],a:2,
     e:'T_load + (N-1)Ã—max(T_load,T_comp) + T_comp = 100 + 3Ã—100 + 10 = 410 ì‚¬ì´í´ì…ë‹ˆë‹¤. í”„ë¡¤ë¡œê·¸(100) + ë©”ì¸ë£¨í”„ 3ë°˜ë³µ(300) + ì—í•„ë¡œê·¸ ì—°ì‚°(10).'},
    {title:'Phase 3: Long Scoreboard ë¶„ì„',
     desc:'í”„ë¡œíŒŒì¼ì—ì„œ Long Scoreboard 60%, Math Pipe 10%ê°€ ë³´ì¸ë‹¤.',
     q:'ì´ ì»¤ë„ì˜ ìƒíƒœì™€ í•´ê²° ë°©ë²•ì€?',
     o:['ì—°ì‚° ë°”ìš´ë“œ â€” ì•Œê³ ë¦¬ì¦˜ ê°œì„  í•„ìš”','ë ˆì´í„´ì‹œ ë°”ìš´ë“œ â€” ë”ë¸” ë²„í¼ë§ìœ¼ë¡œ ë¡œë“œ/ì—°ì‚° ì¤‘ì²© í•„ìš”','ë©”ëª¨ë¦¬ ë°”ìš´ë“œ â€” ìºì‹œ ìµœì í™” í•„ìš”','ì •ìƒ â€” ê°œì„  ë¶ˆí•„ìš”'],a:1,
     e:'Long Scoreboard 60%ëŠ” ë©”ëª¨ë¦¬ ë¡œë“œ ëŒ€ê¸° ìƒíƒœ. ë”ë¸” ë²„í¼ë§ìœ¼ë¡œ ì—°ì‚°ê³¼ ë¡œë“œë¥¼ ì¤‘ì²©í•˜ë©´ ê°œì„ ë©ë‹ˆë‹¤.'},
  ]
},
boss3: {
  name:'ìµœì¢… ë²¤ì¹˜ë§ˆí¬',module:'09',
  phases:[
    {title:'Phase 1: í”„ë¡œíŒŒì¼ í•´ì„',
     desc:'ì»¤ë„ í”„ë¡œíŒŒì¼:\nSM Throughput: 78%, Memory Throughput: 45%\nLong Scoreboard: 8%, Math Pipe: 65%\në ˆì§€ìŠ¤í„°: 128ê°œ/ìŠ¤ë ˆë“œ, ì ìœ ìœ¨: 25%',
     q:'ì´ ì»¤ë„ì˜ ê°€ì¥ ì ì ˆí•œ ìƒíƒœëŠ”?',
     o:['Latency Bound','Memory Bound','Compute Bound (ì—°ì‚° ìœ„ì£¼)','ê· í˜• (Balanced)'],a:2,
     e:'SM 78%ë¡œ ë†’ê³  Memory 45%ë¡œ ì¤‘ê°„, Math Pipeê°€ ì£¼ìš” ìŠ¤í†¨. ì—°ì‚° ìœ„ì£¼ ìƒíƒœì…ë‹ˆë‹¤.'},
    {title:'Phase 2: ì„±ëŠ¥ ê°­ ë¶„ì„',
     desc:'Level 5 ì»¤ë„: 8,500 GFLOP/s (cuBLASì˜ ~88%)\ncuBLAS: 9,650 GFLOP/s',
     q:'ì”ì—¬ 12% ê°­ì˜ ì£¼ëœ ì›ì¸ì€?',
     o:['ë©”ëª¨ë¦¬ ì½”ì–¼ë ˆì‹± ë¶€ì¡±','cuBLASì˜ ë¹„ê³µê°œ ìµœì í™”(ë¶„í• -K, ì›Œí”„ íŠ¹í™” ë“±)','ë ˆì§€ìŠ¤í„° ë¶€ì¡±','CUDA ë²„ì „ ì°¨ì´'],a:1,
     e:'cuBLASëŠ” ë¶„í• -K ì „ëµ, ì›Œí”„ ë ˆë²¨ íŠ¹í™”, ìë™ íŠœë‹ ë“± ê³µê°œë˜ì§€ ì•Šì€ ìµœì í™”ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.'},
    {title:'Phase 3: ê°œì„ ì•ˆ ì„¤ê³„',
     desc:'ì¶”ê°€ ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•œ ê°œì„ ì•ˆì„ ì„ íƒí•˜ì„¸ìš”.',
     q:'ê°€ì¥ íš¨ê³¼ì ì¸ ë‹¤ìŒ ìµœì í™”ëŠ”?',
     o:['ë¸”ë¡ í¬ê¸°ë¥¼ 32Ã—32ë¡œ ë³€ê²½','ë¶„í• -K (Split-K) ì „ëµìœ¼ë¡œ K ì°¨ì› ë³‘ë ¬í™”','ê³µìœ  ë©”ëª¨ë¦¬ë¥¼ ì œê±°í•˜ê³  ë ˆì§€ìŠ¤í„°ë§Œ ì‚¬ìš©','float16ìœ¼ë¡œ ì •ë°€ë„ ë³€ê²½'],a:1,
     e:'ë¶„í• -KëŠ” K ì°¨ì›ì„ ì—¬ëŸ¬ ë¸”ë¡ì— ë¶„ë°°í•˜ì—¬ ë³‘ë ¬ì„±ì„ ë†’ì…ë‹ˆë‹¤. í° Kì—ì„œ íš¨ê³¼ì ì…ë‹ˆë‹¤.'},
  ]
},
};

// --- Shop Items ---
const SHOP_FC = [
  {id:'hint',name:'íŒíŠ¸ í† í°',desc:'í€´ì¦ˆ 1ë¬¸í•­ì— íŒíŠ¸ í‘œì‹œ',price:50,max:null,icon:'ğŸ’¡'},
  {id:'sim_help',name:'ì‹œë®¬ë ˆì´ì…˜ ë„ìš°ë¯¸',desc:'ì½”ë“œ ì¶”ì  ì‹œ ë‹¨ê³„ë³„ íŒíŠ¸',price:75,max:null,icon:'ğŸ”'},
  {id:'retry',name:'ì¬ì‹œë„ í† í°',desc:'í€´ì¦ˆ 1íšŒ ì¬ë„ì „ì„ 1ì°¨ ì‹œë„ë¡œ ë¦¬ì…‹',price:100,max:10,icon:'ğŸ”„'},
  {id:'tooltip',name:'ìš©ì–´ íˆ´íŒ íŒ©',desc:'í•™ìŠµ ì¤‘ ìš©ì–´ ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì •ì˜',price:30,max:1,icon:'ğŸ“–'},
  {id:'freeze',name:'í”„ë¦¬ì¦ˆ í† í°',desc:'ì—°ì† ì ‘ì† ê¸°ë¡ 1ì¼ ë³´ì¡´',price:100,max:null,icon:'â„ï¸'},
  {id:'frame1',name:'í”„ë¡œí•„ í”„ë ˆì„: ì‹¤ë¦¬ì½˜',desc:'í”„ë¡œí•„ í…Œë‘ë¦¬ ì‹¤ë¦¬ì½˜ ì›¨ì´í¼ ìŠ¤í‚¨',price:200,max:1,icon:'ğŸ–¼ï¸'},
  {id:'frame2',name:'í”„ë¡œí•„ í”„ë ˆì„: ë„¤ì˜¨',desc:'í”„ë¡œí•„ í…Œë‘ë¦¬ ë„¤ì˜¨ ê¸€ë¡œìš° ìŠ¤í‚¨',price:200,max:1,icon:'ğŸŒˆ'},
  {id:'title1',name:'ì¹­í˜¸: ë©”ëª¨ë¦¬ ë§ˆìŠ¤í„°',desc:'í”„ë¡œí•„ì— "ë©”ëª¨ë¦¬ ë§ˆìŠ¤í„°" ì¹­í˜¸ í‘œì‹œ',price:300,max:1,icon:'ğŸ·ï¸'},
  {id:'title2',name:'ì¹­í˜¸: íŒŒì´í”„ë¼ì¸ ì¥ì¸',desc:'í”„ë¡œí•„ì— "íŒŒì´í”„ë¼ì¸ ì¥ì¸" ì¹­í˜¸ í‘œì‹œ',price:300,max:1,icon:'ğŸ·ï¸'},
];
const SHOP_SC = [
  {id:'bonus_ch',name:'ë³´ë„ˆìŠ¤ ì±Œë¦°ì§€',desc:'ì¶”ê°€ ì‹¬í™” ë¬¸ì œ ì„¸íŠ¸',price:5,max:10,icon:'ğŸ¯'},
  {id:'mentor',name:'ë©˜í†  ëª¨ë“œ',desc:'AI ëŒ€í™”í˜• ì„¤ëª… (ë¯¸ë˜ ê¸°ëŠ¥)',price:10,max:10,icon:'ğŸ§‘â€ğŸ«'},
  {id:'advanced',name:'ì‹¬í™” ì½˜í…ì¸  íŒ©',desc:'SASS ë¶„ì„ ì‹¬í™” ê°€ì´ë“œ',price:8,max:1,icon:'ğŸ“š'},
  {id:'theme_premium',name:'í”„ë¦¬ë¯¸ì—„ í¬íŠ¸í´ë¦¬ì˜¤ í…Œë§ˆ',desc:'PDF ì¸ì¦ì„œ í”„ë¦¬ë¯¸ì—„ ë””ìì¸',price:15,max:3,icon:'âœ¨'},
];

// --- Achievements ---
const ACHIEVEMENTS = [
  // Tier 1: Module completion (14)
  {id:'m00',name:'ì…ë¬¸ìì˜ ì²«ê±¸ìŒ',tier:1,icon:'ğŸš€',cond:s=>s.completed.includes('00')},
  {id:'m01',name:'í•˜ë“œì›¨ì–´ íƒí—˜ê°€',tier:1,icon:'ğŸ”Œ',cond:s=>s.completed.includes('01')},
  {id:'m02',name:'CUDA ë“œë¼ì´ë²„',tier:1,icon:'ğŸ’»',cond:s=>s.completed.includes('02')},
  {id:'m03',name:'í–‰ë ¬ì˜ ìˆ˜í•™ì',tier:1,icon:'ğŸ“',cond:s=>s.completed.includes('03')},
  {id:'m04',name:'ì²« ë²ˆì§¸ ì»¤ë„',tier:1,icon:'âš¡',cond:s=>s.completed.includes('04')},
  {id:'m05',name:'ë©”ëª¨ë¦¬ ì •ë ¬ì',tier:1,icon:'ğŸ“',cond:s=>s.completed.includes('05')},
  {id:'m06',name:'íƒ€ì¼ ê±´ì¶•ê°€',tier:1,icon:'ğŸ§±',cond:s=>s.completed.includes('06')},
  {id:'m07',name:'ë ˆì§€ìŠ¤í„° ë§ˆì—ìŠ¤íŠ¸ë¡œ',tier:1,icon:'ğŸ¹',cond:s=>s.completed.includes('07')},
  {id:'m08',name:'íŒŒì´í”„ë¼ì¸ ì—”ì§€ë‹ˆì–´',tier:1,icon:'ğŸ”€',cond:s=>s.completed.includes('08')},
  {id:'m09',name:'ë¹„ë™ê¸° ë§ˆìŠ¤í„°',tier:1,icon:'âš¡',cond:s=>s.completed.includes('09')},
  {id:'m10',name:'í”„ë¡œíŒŒì¼ëŸ¬',tier:1,icon:'ğŸ“Š',cond:s=>s.completed.includes('10')},
  // Tier 2: Mastery (3)
  {id:'boss1',name:'ë±…í¬ ì¶©ëŒ ìŠ¬ë ˆì´ì–´',tier:2,icon:'ğŸ›¡ï¸',sc:2,cond:s=>s.bossCleared.includes('boss1')},
  {id:'boss2',name:'ë ˆì´í„´ì‹œ ìŠ¬ë ˆì´ì–´',tier:2,icon:'ğŸ‰',sc:2,cond:s=>s.bossCleared.includes('boss2')},
  {id:'boss3',name:'ë¹„ë™ê¸° ì•„í‚¤í…íŠ¸',tier:2,icon:'ğŸ›ï¸',sc:3,cond:s=>s.bossCleared.includes('boss3')},
  // Tier 3: Skill (8)
  {id:'combo10',name:'Combo King',tier:3,icon:'ğŸ”¥',sc:2,cond:s=>s.maxCombo>=10},
  {id:'gflops5k',name:'GFLOP/s Champion',tier:3,icon:'ğŸ†',sc:3,cond:s=>s.gflops>=5000},
  {id:'fc5k',name:'Economy Wizard',tier:3,icon:'ğŸ’°',sc:2,cond:s=>s.fcTotal>=5000},
  {id:'perfect3',name:'Diamond Mastery',tier:3,icon:'ğŸ’',sc:3,cond:s=>s.perfectModules>=3},
  {id:'full',name:'Full Architect',tier:3,icon:'ğŸ‘‘',sc:3,cond:s=>s.completed.length>=11},
  // Tier 4: Hidden (3)
  {id:'humble',name:'The Humble Beginning',tier:4,icon:'ğŸŒ±',sc:2,hidden:true,cond:s=>s.completed.includes('04')&&s.quizScores['04']>=80},
  {id:'100x',name:'100x',tier:4,icon:'ğŸ’¯',sc:2,hidden:true,cond:s=>s.completed.includes('09')&&s.quizScores['09']>=80},
  {id:'why_all',name:'Why Not How',tier:4,icon:'ğŸ¤”',sc:3,hidden:true,cond:s=>Object.keys(s.codeTracesDone||{}).length>=5},
];

// --- Bloom Level Labels ---
const BLOOM_LABELS = {R:'ê¸°ì–µ',U:'ì´í•´',Ap:'ì ìš©',An:'ë¶„ì„',Ev:'í‰ê°€',Cr:'ì°½ì¡°'};
const BLOOM_ICONS = {R:'ğŸ’­',U:'ğŸ“–',Ap:'ğŸ”§',An:'ğŸ”',Ev:'âš–ï¸',Cr:'ğŸ—ï¸'};

// ============================================================
// GPU Architect: Rise from Silicon â€” Game Engine + UI
// ============================================================

// === STATE ===
const DEFAULT_STATE = {
  name:'',fc:0,sc:0,fcTotal:0,scTotal:0,
  rankIdx:0,completed:[],masteryPassed:[],bossCleared:[],
  quizScores:{},quizAttempts:{},codeTracesDone:{},reviewsDone:{},
  maxCombo:0,gflops:0,perfectModules:0,
  streak:0,longestStreak:0,lastDate:null,
  inventory:{},earnedBadges:[],
  hintsUsed:{},
};
let S = loadState();
function loadState(){ try{return JSON.parse(localStorage.getItem('gpu_architect_save'))||{...DEFAULT_STATE}}catch(e){return{...DEFAULT_STATE}} }
function saveState(){ localStorage.setItem('gpu_architect_save',JSON.stringify(S)); }
function addFC(n){ S.fc+=n; S.fcTotal+=n; saveState(); updateNav(); }
function addSC(n){ S.sc+=n; saveState(); updateNav(); }
function spendFC(n){ if(S.fc>=n){S.fc-=n;saveState();updateNav();return true}return false; }
function spendSC(n){ if(S.sc>=n){S.sc-=n;saveState();updateNav();return true}return false; }

// === ENGINES ===
function getComboMult(c){ return c>=7?3:c>=5?2:c>=3?1.5:1; }
function getRank(){ return RANKS[S.rankIdx]; }
function calcGflops(){
  const r=getRank();
  const scores=Object.values(S.quizScores);
  const avg=scores.length?scores.reduce((a,b)=>a+b,0)/scores.length/100:0;
  S.gflops=Math.floor(r.gflops*(0.5+avg*0.5));
  saveState();
}
function checkRankUp(){
  let newIdx=S.rankIdx;
  for(let i=S.rankIdx+1;i<RANKS.length;i++){
    const r=RANKS[i];
    const modsOk=r.modules.every(m=>S.completed.includes(m));
    const mastOk=!r.masteryReq||S.masteryPassed.includes(r.masteryReq);
    if(modsOk&&mastOk) newIdx=i; else break;
  }
  if(newIdx>S.rankIdx){
    S.rankIdx=newIdx;
    calcGflops();
    saveState();
    showToast(`ìŠ¹ì§„! ${RANKS[newIdx].icon} ${RANKS[newIdx].name}`,'rank');
    return true;
  }
  return false;
}
function checkAchievements(){
  const info={completed:S.completed,bossCleared:S.bossCleared,maxCombo:S.maxCombo,
    gflops:S.gflops,fcTotal:S.fcTotal,perfectModules:S.perfectModules,
    quizScores:S.quizScores,codeTracesDone:S.codeTracesDone};
  ACHIEVEMENTS.forEach(a=>{
    if(!S.earnedBadges.includes(a.id)&&a.cond(info)){
      S.earnedBadges.push(a.id);
      if(a.sc)addSC(a.sc);
      showToast(`ë°°ì§€ íšë“! ${a.icon} ${a.name}`,'badge');
    }
  });
  saveState();
}
function isModuleAvailable(id){
  const idx=MODULES.findIndex(m=>m.id===id);
  if(idx===0)return true;
  return S.completed.includes(MODULES[idx-1].id);
}
function checkStreak(){
  const today=new Date().toDateString();
  if(S.lastDate===today)return;
  const yesterday=new Date(Date.now()-86400000).toDateString();
  if(S.lastDate===yesterday){S.streak++;} else if(S.lastDate!==today){S.streak=1;}
  S.lastDate=today;
  if(S.streak>S.longestStreak)S.longestStreak=S.streak;
  const bonus=Math.min(S.streak*10,100);
  addFC(bonus);
  showToast(`ì¼ì¼ ì ‘ì† ${S.streak}ì¼! +${bonus} FC`,'reward');
  saveState();
}

// === TOASTS ===
let toastTimeout;
function showToast(msg,type='reward'){
  const old=document.querySelector('.toast');if(old)old.remove();
  const t=document.createElement('div');t.className=`toast ${type}`;t.textContent=msg;
  document.body.appendChild(t);
  clearTimeout(toastTimeout);
  toastTimeout=setTimeout(()=>t.remove(),3000);
}

// === NAV ===
function updateNav(){
  const nav=document.getElementById('topnav');if(!nav)return;
  const r=getRank();
  nav.innerHTML=`
    <div class="logo" onclick="navigate('dashboard')" style="cursor:pointer">${r.icon} GPU Architect</div>
    <div class="stats">
      <span>${r.name}</span>
      <span class="fc-icon">âš¡${S.fc}</span>
      <span class="sc-icon">ğŸ’${S.sc}</span>
      <span style="color:var(--green)">${S.gflops.toLocaleString()} GFLOP/s</span>
    </div>`;
}

// === NAVIGATION ===
let currentScreen='';
let screenParams={};
function navigate(screen,params={}){
  currentScreen=screen;screenParams=params;
  const main=document.getElementById('main');
  main.innerHTML='';
  switch(screen){
    case'welcome':renderWelcome(main);break;
    case'dashboard':renderDashboard(main);break;
    case'module':renderModule(main,params.id);break;
    case'quiz':renderQuiz(main,params.id);break;
    case'codetrace':renderCodeTrace(main,params.id);break;
    case'review':renderReview(main,params.id);break;
    case'boss':renderBoss(main,params.id);break;
    case'shop':renderShop(main);break;
    case'badges':renderBadges(main);break;
    case'result':renderResult(main,params);break;
    default:renderDashboard(main);
  }
  window.scrollTo(0,0);
}

// === SCREENS ===

function renderWelcome(el){
  el.innerHTML=`
    <div style="text-align:center;padding:60px 20px">
      <div style="font-size:3rem;margin-bottom:16px">ğŸ—ï¸</div>
      <h1 style="font-size:1.8rem;margin-bottom:8px;background:linear-gradient(90deg,var(--cyan),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent">
        GPU Architect:<br>Rise from Silicon</h1>
      <p style="color:var(--dim);margin-bottom:32px">SiliconForgeì—ì„œ ê°€ì¥ ë¹ ë¥¸ í–‰ë ¬ê³± ì—”ì§„ì„ ë§Œë“œì„¸ìš”<br>ë‚˜ì´ë¸Œ 50 GFLOP/s â†’ cuBLAS 95% (9,500 GFLOP/s)</p>
      <input id="nameInput" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" style="padding:12px 20px;border-radius:8px;border:2px solid var(--border);background:var(--card);color:var(--text);font-size:1rem;width:240px;margin-bottom:16px;text-align:center">
      <br>
      <button class="btn btn-primary" onclick="startGame()" style="font-size:1.1rem;padding:14px 40px">ì…ì‚¬í•˜ê¸°</button>
      <p style="color:var(--dim);margin-top:24px;font-size:.8rem">75ê°œ í€´ì¦ˆ Â· 6ê°œ ì½”ë“œ ì¶”ì  Â· 3ê°œ ë³´ìŠ¤ì „ Â· 33ê°œ ë°°ì§€</p>
    </div>`;
  setTimeout(()=>{const inp=document.getElementById('nameInput');if(inp)inp.focus()},100);
}
function startGame(){
  const name=document.getElementById('nameInput').value.trim();
  if(!name)return showToast('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”','error');
  S.name=name;saveState();
  document.getElementById('topnav').style.display='flex';
  updateNav();checkStreak();navigate('dashboard');
}

function renderDashboard(el){
  const r=getRank();
  const nextR=S.rankIdx<RANKS.length-1?RANKS[S.rankIdx+1]:null;
  const completedPct=Math.round(S.completed.length/11*100);
  el.innerHTML=`
    <div class="rank-display">
      <div class="rank-icon">${r.icon}</div>
      <div class="rank-info">
        <div class="rank-name">${r.name}</div>
        <div class="rank-sub">${r.en} Â· ${S.name}</div>
        <div class="gflops">${S.gflops.toLocaleString()} GFLOP/s Â· cuBLAS ${r.cubl}%</div>
      </div>
    </div>
    ${nextR?`<div class="card" style="padding:12px 16px">
      <div style="display:flex;justify-content:space-between;font-size:.85rem">
        <span>ë‹¤ìŒ ì§ê¸‰: ${nextR.icon} ${nextR.name}</span>
        <span style="color:var(--dim)">í•„ìš”: ${nextR.modules.filter(m=>!S.completed.includes(m)).map(m=>'ëª¨ë“ˆ '+m).join(', ')||'ì¤€ë¹„ ì™„ë£Œ'}${nextR.masteryReq&&!S.masteryPassed.includes(nextR.masteryReq)?' + ë§ˆìŠ¤í„°ë¦¬ '+nextR.masteryReq:''}</span>
      </div>
    </div>`:''}
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <h2 style="margin:0">í•™ìŠµ ëª¨ë“ˆ</h2>
        <span style="color:var(--dim);font-size:.85rem">${S.completed.length}/11 ì™„ë£Œ (${completedPct}%)</span>
      </div>
      <div class="progress-bar"><div class="progress-fill cyan" style="width:${completedPct}%"></div></div>
      <div class="module-grid" id="moduleGrid"></div>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <button class="btn btn-secondary" onclick="navigate('shop')">ğŸ›’ ìƒì </button>
      <button class="btn btn-secondary" onclick="navigate('badges')">ğŸ† ë°°ì§€ (${S.earnedBadges.length}/${ACHIEVEMENTS.filter(a=>!a.hidden||S.earnedBadges.includes(a.id)).length})</button>
      <button class="btn btn-secondary" onclick="if(confirm('ì§„í–‰ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){localStorage.removeItem('gpu_architect_save');location.reload()}">ì´ˆê¸°í™”</button>
    </div>
    <div class="card" style="margin-top:16px">
      <h3>í†µê³„</h3>
      <div class="stat-row">
        <div class="stat-box"><div class="stat-val">${S.streak}</div><div class="stat-label">ì—°ì† ì ‘ì†</div></div>
        <div class="stat-box"><div class="stat-val">${S.maxCombo}</div><div class="stat-label">ìµœëŒ€ ì½¤ë³´</div></div>
        <div class="stat-box"><div class="stat-val">âš¡${S.fcTotal}</div><div class="stat-label">ì´ FC íšë“</div></div>
        <div class="stat-box"><div class="stat-val">${Object.keys(S.quizScores).length}</div><div class="stat-label">í€´ì¦ˆ ì™„ë£Œ</div></div>
      </div>
    </div>`;
  const grid=document.getElementById('moduleGrid');
  MODULES.forEach(m=>{
    const done=S.completed.includes(m.id);
    const avail=isModuleAvailable(m.id);
    const isMastery=m.mastery;
    const score=S.quizScores[m.id];
    const cell=document.createElement('div');
    cell.className=`module-cell ${done?'completed':avail?'current':'locked'} ${isMastery?'mastery':''}`;
    cell.innerHTML=`
      <div class="mod-num">${m.id}</div>
      <div class="mod-title">${m.sub}</div>
      ${score!=null?`<div class="mod-score">${score}%</div>`:''}
      ${!avail?'<div class="lock-icon">ğŸ”’</div>':''}`;
    if(avail)cell.onclick=()=>navigate('module',{id:m.id});
    grid.appendChild(cell);
  });
}

function renderModule(el,id){
  const m=MODULES.find(x=>x.id===id);if(!m)return navigate('dashboard');
  const done=S.completed.includes(id);
  const sections=[];
  if(m.hasReview)sections.push({name:'ê¸°ì–µë ¥ ì±Œë¦°ì§€',icon:'â±ï¸',type:'review',reward:'30-50 FC',done:!!S.reviewsDone[id]});
  if(m.hasCode)sections.push({name:'ì½”ë“œ ì¶”ì ',icon:'ğŸ’»',type:'codetrace',reward:'ìµœëŒ€ 30 FC',done:!!S.codeTracesDone[id]});
  if(m.hasQuiz)sections.push({name:m.mastery?'ë§ˆìŠ¤í„°ë¦¬ ì²´í¬í¬ì¸íŠ¸ í€´ì¦ˆ':'ìµœì í™” ì±Œë¦°ì§€ í€´ì¦ˆ',icon:m.mastery?'âš”ï¸':'ğŸ“',type:'quiz',reward:'ê°€ë³€ FC',done:S.quizScores[id]!=null});
  if(m.boss)sections.push({name:`ë³´ìŠ¤ì „: ${BOSSES[m.boss].name}`,icon:'ğŸ‰',type:'boss',reward:'300 FC + SC',done:S.bossCleared.includes(m.boss)});

  el.innerHTML=`
    <button class="btn btn-sm btn-secondary back-btn" onclick="navigate('dashboard')">â† ëŒ€ì‹œë³´ë“œ</button>
    <div class="card">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
        <div style="font-size:2rem;width:48px;height:48px;display:flex;align-items:center;justify-content:center;background:var(--card2);border-radius:12px">${m.level!=null?'L'+m.level:'ğŸ“–'}</div>
        <div>
          <h2 style="margin:0">${m.title}</h2>
          <div style="color:var(--dim);font-size:.85rem">${m.sub}</div>
        </div>
      </div>
      ${m.level!=null?`<div style="font-size:.85rem;color:var(--dim);margin-bottom:12px">
        ${RANKS.find(r=>r.modules.includes(id))?`ì™„ë£Œ ì‹œ ìŠ¹ì§„ ì¡°ê±´ ì§„í–‰`:''}</div>`:''}
      <div class="section-list" id="sectionList"></div>
    </div>
    ${done?`<div class="result-banner pass" style="margin-top:8px"><h2>âœ… ëª¨ë“ˆ ì™„ë£Œ</h2>
      <p>í€´ì¦ˆ ì ìˆ˜: ${S.quizScores[id]||0}%</p></div>`:''}`;

  const list=document.getElementById('sectionList');
  sections.forEach((s,i)=>{
    const prevDone=i===0||sections[i-1].done;
    const locked=!prevDone&&!s.done;
    const div=document.createElement('div');
    div.className=`section-item ${s.done?'done':''} ${locked?'locked':''}`;
    div.innerHTML=`
      <div class="sec-icon">${s.done?'âœ…':s.icon}</div>
      <div class="sec-name">${s.name}</div>
      <div class="sec-reward">${s.done?'ì™„ë£Œ':s.reward}</div>`;
    if(!locked)div.onclick=()=>{
      if(s.type==='quiz')navigate('quiz',{id});
      else if(s.type==='codetrace')navigate('codetrace',{id});
      else if(s.type==='review')navigate('review',{id});
      else if(s.type==='boss')navigate('boss',{id:m.boss});
    };
    list.appendChild(div);
  });
}

// === QUIZ (Game F) ===
function renderQuiz(el,modId){
  const qs=QUIZZES[modId];if(!qs)return navigate('module',{id:modId});
  const m=MODULES.find(x=>x.id===modId);
  const gflopsRange=m.level!=null?RANKS.find(r=>r.modules.includes(modId)):null;
  let idx=0,combo=0,totalFC=0,correct=0,answered=[];
  const hintsAvail=S.inventory.hint||0;

  function render(){
    const q=qs[idx];
    const pct=Math.round(correct/qs.length*100);
    const mult=getComboMult(combo);
    const gfStr=gflopsRange?`${Math.round(gflopsRange.gflops*pct/100).toLocaleString()}`:`â€”`;
    el.innerHTML=`
      <button class="btn btn-sm btn-secondary back-btn" onclick="navigate('module',{id:'${modId}'})">â† ëª¨ë“ˆ ${modId}</button>
      <div class="quiz-header">
        <span style="color:var(--dim)">ë¬¸í•­ ${idx+1}/${qs.length}</span>
        <div class="combo-display ${mult>=3?'fire':''}">${combo>0?`${combo}ì—°ì† Ã—${mult}`:'ì½¤ë³´ ì—†ìŒ'}</div>
        <span>FC: +${totalFC}</span>
      </div>
      <div class="gflops-meter">
        <div class="gflops-fill" style="width:${pct}%"></div>
        <div class="gflops-label">${gfStr} GFLOP/s (${pct}%)</div>
      </div>
      <div class="question-card">
        <span class="bloom-tag bloom-${q.b}">${BLOOM_ICONS[q.b]} ${BLOOM_LABELS[q.b]}</span>
        <div class="question-text">${q.q}</div>
        <div class="options" id="opts"></div>
        <div id="feedback"></div>
      </div>
      <div id="quizNav" style="display:none;text-align:center;margin-top:12px"></div>`;
    const opts=document.getElementById('opts');
    q.o.forEach((opt,oi)=>{
      const btn=document.createElement('button');
      btn.className='option-btn';
      btn.textContent=`(${String.fromCharCode(65+oi)}) ${opt}`;
      btn.onclick=()=>answer(oi);
      opts.appendChild(btn);
    });
  }

  function answer(chosen){
    const q=qs[idx];
    const isCorrect=chosen===q.a;
    const btns=document.querySelectorAll('.option-btn');
    btns.forEach((b,i)=>{
      b.disabled=true;
      if(i===q.a)b.classList.add('correct');
      if(i===chosen&&!isCorrect)b.classList.add('wrong');
    });
    if(isCorrect){
      combo++;
      const mult=getComboMult(combo);
      const fc=Math.round(20*mult);
      totalFC+=fc;correct++;
      addFC(fc);
      if(combo>S.maxCombo){S.maxCombo=combo;saveState();}
      showToast(`ì •ë‹µ! +${fc} FC (Ã—${mult})`,'reward');
    } else {
      combo=0;
    }
    answered.push(isCorrect);
    document.getElementById('feedback').innerHTML=`
      <div class="explanation">${isCorrect?'âœ… ì •ë‹µ!':'âŒ ì˜¤ë‹µ'} â€” ${q.e}</div>`;
    const nav=document.getElementById('quizNav');
    nav.style.display='block';
    if(idx<qs.length-1){
      nav.innerHTML=`<button class="btn btn-primary" onclick="nextQ()">ë‹¤ìŒ ë¬¸í•­ â†’</button>`;
    } else {
      nav.innerHTML=`<button class="btn btn-gold" onclick="finishQuiz()">ê²°ê³¼ ë³´ê¸°</button>`;
    }
    window.nextQ=()=>{idx++;render()};
    window.finishQuiz=()=>{
      const score=Math.round(correct/qs.length*100);
      if(score===100){totalFC+=100;addFC(100);}
      S.quizScores[modId]=Math.max(S.quizScores[modId]||0,score);
      S.quizAttempts[modId]=(S.quizAttempts[modId]||0)+1;
      if(score===100)S.perfectModules=(S.perfectModules||0)+1;
      const isMastery=MODULES.find(x=>x.id===modId)?.mastery;
      const passed=isMastery?score>=80:score>=60;
      if(passed&&!S.completed.includes(modId)){
        S.completed.push(modId);
        if(isMastery&&!S.masteryPassed.includes(modId))S.masteryPassed.push(modId);
        addFC(isMastery?300:0);
      }
      saveState();calcGflops();checkRankUp();checkAchievements();
      navigate('result',{modId,score,correct,total:qs.length,fc:totalFC,maxCombo:Math.max(...answered.map((_,i)=>{let c=0,m=0;for(let j=0;j<=i;j++){if(answered[j])c++;else c=0;if(c>m)m=c;}return m;})),passed,isMastery});
    };
  }
  render();
}

// === CODE TRACE (Game C) ===
function renderCodeTrace(el,modId){
  const ct=CODE_TRACES[modId];if(!ct)return navigate('module',{id:modId});
  let idx=0,streak=0,fc=0;

  function render(){
    const step=ct.steps[idx];
    el.innerHTML=`
      <button class="btn btn-sm btn-secondary back-btn" onclick="navigate('module',{id:'${modId}'})">â† ëª¨ë“ˆ ${modId}</button>
      <div class="card">
        <h2>ğŸ’» ì½”ë“œ ì¶”ì : ${ct.title}</h2>
        <div class="code-block">${ct.code}</div>
      </div>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <span>ìŠ¤í… ${idx+1}/${ct.steps.length}</span>
          <span class="streak-display">${streak>=5?'ğŸ”¥':''}ì—°ì† ì •ë‹µ: ${streak}</span>
        </div>
        <div class="question-text">${step.prompt}</div>
        <div class="trace-input">
          <input type="number" id="traceAnswer" placeholder="ë‹µ ì…ë ¥" onkeydown="if(event.key==='Enter')checkTrace()">
          <button class="btn btn-primary btn-sm" onclick="checkTrace()">í™•ì¸</button>
          <button class="btn btn-sm btn-secondary" onclick="showHintTrace()">íŒíŠ¸</button>
        </div>
        <div id="traceFeedback"></div>
        <div id="traceNav" style="display:none;margin-top:12px"></div>
      </div>
      <div style="text-align:right;color:var(--dim);font-size:.85rem">íšë“ FC: +${fc}</div>`;
    setTimeout(()=>{const inp=document.getElementById('traceAnswer');if(inp)inp.focus()},100);
  }

  window.showHintTrace=()=>{
    document.getElementById('traceFeedback').innerHTML=`<div class="explanation">ğŸ’¡ íŒíŠ¸: ${ct.steps[idx].hint}</div>`;
  };
  window.checkTrace=()=>{
    const inp=document.getElementById('traceAnswer');
    const val=parseInt(inp.value);
    const correct=val===ct.steps[idx].answer;
    if(correct){streak++;if(streak===5){fc+=30;addFC(30);showToast('5ì—°ì† ì •ë‹µ! +30 FC','reward');}
      if(streak===10){fc+=30;addFC(30);showToast('10ì—°ì†! +30 FC','reward');}
      document.getElementById('traceFeedback').innerHTML=`<div class="explanation" style="border-color:var(--green)">âœ… ì •ë‹µ! ${ct.steps[idx].answer}</div>`;
    } else {
      streak=0;
      document.getElementById('traceFeedback').innerHTML=`<div class="explanation" style="border-color:var(--red)">âŒ ì˜¤ë‹µ. ì •ë‹µ: ${ct.steps[idx].answer}<br>ğŸ’¡ ${ct.steps[idx].hint}</div>`;
    }
    inp.disabled=true;
    const nav=document.getElementById('traceNav');nav.style.display='block';
    if(idx<ct.steps.length-1){
      nav.innerHTML=`<button class="btn btn-primary btn-sm" onclick="nextTrace()">ë‹¤ìŒ ìŠ¤í… â†’</button>`;
    } else {
      nav.innerHTML=`<button class="btn btn-gold btn-sm" onclick="finishTrace()">ì™„ë£Œ</button>`;
    }
    window.nextTrace=()=>{idx++;render()};
    window.finishTrace=()=>{
      S.codeTracesDone[modId]=true;saveState();checkAchievements();
      showToast(`ì½”ë“œ ì¶”ì  ì™„ë£Œ! +${fc} FC`,'reward');
      navigate('module',{id:modId});
    };
  };
  render();
}

// === MEMORY CHALLENGE (Game A) ===
function renderReview(el,modId){
  const qs=REVIEWS[modId];if(!qs)return navigate('module',{id:modId});
  let idx=0,correct=0,startTime=Date.now();
  const TIMEOUT=60000;

  function render(){
    const elapsed=Date.now()-startTime;
    const remaining=Math.max(0,Math.ceil((TIMEOUT-elapsed)/1000));
    const q=qs[idx];
    el.innerHTML=`
      <button class="btn btn-sm btn-secondary back-btn" onclick="navigate('module',{id:'${modId}'})">â† ëª¨ë“ˆ ${modId}</button>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <h2>â±ï¸ ê¸°ì–µë ¥ ì±Œë¦°ì§€</h2>
          <div class="timer ${remaining<=30?remaining<=10?'danger':'warning':''}">${remaining}ì´ˆ</div>
        </div>
        <div style="color:var(--dim);font-size:.85rem;margin-bottom:12px">ì´ì „ ëª¨ë“ˆì—ì„œ ë°°ìš´ ë‚´ìš©ì„ ë– ì˜¬ë ¤ë³´ì„¸ìš”! (${idx+1}/3)</div>
        <div class="question-text">${q.q}</div>
        <div class="options" id="revOpts"></div>
        <div id="revFeedback"></div>
      </div>`;
    const opts=document.getElementById('revOpts');
    q.o.forEach((opt,oi)=>{
      const btn=document.createElement('button');
      btn.className='option-btn';
      btn.textContent=opt;
      btn.onclick=()=>answerReview(oi);
      opts.appendChild(btn);
    });
  }

  function answerReview(chosen){
    const q=qs[idx];
    const isCorrect=chosen===q.a;
    if(isCorrect)correct++;
    document.querySelectorAll('.option-btn').forEach((b,i)=>{b.disabled=true;if(i===q.a)b.classList.add('correct');if(i===chosen&&!isCorrect)b.classList.add('wrong');});
    document.getElementById('revFeedback').innerHTML=`<div class="explanation">${isCorrect?'âœ… ì •ë‹µ!':'âŒ ì˜¤ë‹µ'}</div>`;
    setTimeout(()=>{
      if(idx<2){idx++;render();}
      else{
        const elapsed=Date.now()-startTime;
        let fc=30;
        if(correct===3&&elapsed<30000){fc=50;showToast('30ì´ˆ ë‚´ ë§Œì ! +50 FC','reward');}
        else showToast(`ê¸°ì–µë ¥ ì±Œë¦°ì§€ ì™„ë£Œ! +${fc} FC`,'reward');
        addFC(fc);S.reviewsDone[modId]=true;saveState();
        setTimeout(()=>navigate('module',{id:modId}),1000);
      }
    },800);
  }
  render();
  const timer=setInterval(()=>{
    const rem=Math.max(0,Math.ceil((TIMEOUT-(Date.now()-startTime))/1000));
    const td=document.querySelector('.timer');if(td){
      td.textContent=rem+'ì´ˆ';
      td.className=`timer ${rem<=10?'danger':rem<=30?'warning':''}`;
    }
    if(rem<=0){clearInterval(timer);addFC(30);S.reviewsDone[modId]=true;saveState();
      showToast('ì‹œê°„ ì´ˆê³¼! +30 FC (ì°¸ì—¬ ë³´ìƒ)','reward');
      navigate('module',{id:modId});}
  },1000);
}

// === BOSS FIGHT ===
function renderBoss(el,bossId){
  const boss=BOSSES[bossId];if(!boss)return navigate('dashboard');
  let phase=0,correct=0;

  function render(){
    const p=boss.phases[phase];
    el.innerHTML=`
      <button class="btn btn-sm btn-secondary back-btn" onclick="navigate('module',{id:'${boss.module}'})">â† ëª¨ë“ˆ ${boss.module}</button>
      <div class="boss-header">
        <h2>âš”ï¸ ${boss.name}</h2>
        <div class="boss-sub">ë§ˆìŠ¤í„°ë¦¬ ì²´í¬í¬ì¸íŠ¸ â€” 80% ì´ìƒ í†µê³¼ í•„ìˆ˜</div>
        <div class="phase-indicator">${boss.phases.map((_,i)=>`<div class="phase-dot ${i<phase?'done':i===phase?'active':''}"></div>`).join('')}</div>
      </div>
      <div class="card">
        <h3>${p.title}</h3>
        <div class="question-text" style="margin:12px 0">${p.desc}</div>
        <div class="question-text" style="font-weight:600">${p.q}</div>
        <div class="options" id="bossOpts"></div>
        <div id="bossFeedback"></div>
      </div>`;
    const opts=document.getElementById('bossOpts');
    p.o.forEach((opt,oi)=>{
      const btn=document.createElement('button');
      btn.className='option-btn';
      btn.textContent=opt;
      btn.onclick=()=>answerBoss(oi);
      opts.appendChild(btn);
    });
  }

  function answerBoss(chosen){
    const p=boss.phases[phase];
    const isCorrect=chosen===p.a;
    if(isCorrect)correct++;
    document.querySelectorAll('.option-btn').forEach((b,i)=>{b.disabled=true;if(i===p.a)b.classList.add('correct');if(i===chosen&&!isCorrect)b.classList.add('wrong');});
    document.getElementById('bossFeedback').innerHTML=`<div class="explanation">${isCorrect?'âœ… ì •ë‹µ!':'âŒ ì˜¤ë‹µ'} â€” ${p.e}</div>`;
    setTimeout(()=>{
      if(phase<boss.phases.length-1){phase++;render();}
      else finishBoss();
    },1500);
  }

  function finishBoss(){
    const score=Math.round(correct/boss.phases.length*100);
    const passed=score>=80;
    if(passed){
      addFC(300);
      const scAmt=correct===boss.phases.length?10:5;
      addSC(scAmt);
      if(!S.bossCleared.includes(bossId)){S.bossCleared.push(bossId);saveState();}
      if(!S.masteryPassed.includes(boss.module)){S.masteryPassed.push(boss.module);saveState();}
      if(!S.completed.includes(boss.module)){S.completed.push(boss.module);saveState();}
      checkRankUp();checkAchievements();
      showToast(`ë³´ìŠ¤ì „ í´ë¦¬ì–´! +300 FC +${correct===boss.phases.length?10:5} SC`,'rank');
    }
    navigate('result',{modId:boss.module,score,correct,total:boss.phases.length,fc:passed?300:0,passed,isMastery:true,isBoss:true,bossName:boss.name});
  }
  render();
}

// === RESULT ===
function renderResult(el,p){
  el.innerHTML=`
    <div class="result-banner ${p.passed?'pass':'fail'}">
      <div style="font-size:2.5rem;margin-bottom:8px">${p.passed?'ğŸ‰':'ğŸ˜“'}</div>
      <h2>${p.isBoss?p.bossName:p.isMastery?'ë§ˆìŠ¤í„°ë¦¬ ì²´í¬í¬ì¸íŠ¸':'í€´ì¦ˆ'} ${p.passed?'í†µê³¼!':'ë¯¸í†µê³¼'}</h2>
      <p style="font-size:1.2rem;margin:8px 0">${p.score}%</p>
      ${!p.passed&&p.isMastery?'<p style="color:var(--dim)">80% ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤. ë³µìŠµ í›„ ì¬ë„ì „í•˜ì„¸ìš”!</p>':''}
    </div>
    <div class="stat-row">
      <div class="stat-box"><div class="stat-val">${p.correct}/${p.total}</div><div class="stat-label">ì •ë‹µ</div></div>
      <div class="stat-box"><div class="stat-val" style="color:var(--cyan)">+${p.fc}</div><div class="stat-label">íšë“ FC</div></div>
      <div class="stat-box"><div class="stat-val" style="color:var(--green)">${S.gflops.toLocaleString()}</div><div class="stat-label">GFLOP/s</div></div>
    </div>
    <div style="text-align:center;margin-top:20px">
      <button class="btn btn-primary" onclick="navigate('module',{id:'${p.modId}'})">ëª¨ë“ˆë¡œ ëŒì•„ê°€ê¸°</button>
      <button class="btn btn-secondary" style="margin-left:8px" onclick="navigate('dashboard')">ëŒ€ì‹œë³´ë“œ</button>
    </div>`;
}

// === SHOP ===
function renderShop(el){
  el.innerHTML=`
    <button class="btn btn-sm btn-secondary back-btn" onclick="navigate('dashboard')">â† ëŒ€ì‹œë³´ë“œ</button>
    <div class="card">
      <h2>ğŸ›’ ìƒì </h2>
      <div class="tabs">
        <div class="tab active" onclick="showShopTab('fc',this)">âš¡ FC ìƒì </div>
        <div class="tab" onclick="showShopTab('sc',this)">ğŸ’ SC ìƒì </div>
      </div>
      <div id="shopContent"></div>
    </div>`;
  window.showShopTab=(type,tabEl)=>{
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    tabEl.classList.add('active');
    const items=type==='fc'?SHOP_FC:SHOP_SC;
    const currency=type==='fc'?'FC':'SC';
    const bal=type==='fc'?S.fc:S.sc;
    const content=document.getElementById('shopContent');
    content.innerHTML=`<div style="text-align:right;margin-bottom:12px;font-weight:600">${type==='fc'?'âš¡':'ğŸ’'}ì”ì•¡: ${bal} ${currency}</div><div class="shop-grid"></div>`;
    const grid=content.querySelector('.shop-grid');
    items.forEach(item=>{
      const owned=S.inventory[item.id]||0;
      const maxed=item.max!=null&&owned>=item.max;
      const canBuy=!maxed&&(type==='fc'?S.fc:S.sc)>=item.price;
      const div=document.createElement('div');
      div.className='shop-item';
      div.innerHTML=`
        <div class="item-name">${item.icon} ${item.name}</div>
        <div class="item-desc">${item.desc}</div>
        ${maxed?'<div style="color:var(--dim);font-size:.85rem">êµ¬ë§¤ ì™„ë£Œ</div>':`
        <div style="display:flex;justify-content:space-between;align-items:center">
          <span class="item-price" style="color:${type==='fc'?'var(--cyan)':'var(--gold)'}">${type==='fc'?'âš¡':'ğŸ’'}${item.price}</span>
          <button class="btn btn-sm ${canBuy?'btn-primary':'btn-secondary'}" ${canBuy?'':'disabled'} onclick="buyItem('${item.id}','${type}',${item.price})">êµ¬ë§¤${owned?' ('+owned+'ê°œ)':''}</button>
        </div>`}`;
      grid.appendChild(div);
    });
  };
  window.buyItem=(id,type,price)=>{
    const ok=type==='fc'?spendFC(price):spendSC(price);
    if(ok){S.inventory[id]=(S.inventory[id]||0)+1;saveState();showToast('êµ¬ë§¤ ì™„ë£Œ!','reward');showShopTab(type,document.querySelector('.tab.active'));}
  };
  showShopTab('fc',document.querySelector('.tab.active'));
}

// === BADGES ===
function renderBadges(el){
  el.innerHTML=`
    <button class="btn btn-sm btn-secondary back-btn" onclick="navigate('dashboard')">â† ëŒ€ì‹œë³´ë“œ</button>
    <div class="card">
      <h2>ğŸ† ì—…ì  ë°°ì§€</h2>
      <div style="color:var(--dim);margin-bottom:16px">${S.earnedBadges.length}ê°œ íšë“</div>
      <div class="badge-grid" id="badgeGrid"></div>
    </div>`;
  const grid=document.getElementById('badgeGrid');
  ACHIEVEMENTS.forEach(a=>{
    const earned=S.earnedBadges.includes(a.id);
    const show=!a.hidden||earned;
    if(!show)return;
    const div=document.createElement('div');
    div.className=`badge ${earned?'earned':'locked'}`;
    div.innerHTML=`<div class="badge-icon">${earned?a.icon:'â“'}</div><div>${earned?a.name:'???'}</div>
      <div style="color:var(--dim);font-size:.65rem">Tier ${a.tier}</div>`;
    grid.appendChild(div);
  });
}

// === INIT ===
function init(){
  const app=document.getElementById('app');
  app.innerHTML=`<nav id="topnav" style="display:none"></nav><main id="main"></main>`;
  if(S.name){
    document.getElementById('topnav').style.display='flex';
    updateNav();calcGflops();checkStreak();navigate('dashboard');
  } else {
    navigate('welcome');
  }
}
init();
</script>
</body>
</html>
